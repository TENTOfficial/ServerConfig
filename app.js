var child,childDaemon,allData,helpData,getinfoData,z_sendmanyData,z_getoperationstatusData,z_shieldcoinbaseData,validateaddressData,masternodelistData,masternodeoutputsData,masternodegenkeyData,importprivkeyData,dumpprivkeyData,startmasternodeData,getPeerInfoData,getDebugData,getNewAddressData,walletDic,listtransactions,listtransactionstime,sendingCoin,w,startaliasData,currentCoin,autoLauncher,progName,lastBlock,lastBalance,lastTotalBalance,bot,balance,priceandsymbol,transactions,addrBook,isBotCmd,appVersion="1.0.5a",betaTest=!1,app=angular.module("modernwallet",[]),miningProcess=require("child_process"),StackTrace=require("stacktrace-js"),autoLaunch=require("auto-launch"),exec=require("child_process").exec,fs=require("fs"),fsextra=require("fs-extra"),electron=require("electron"),remote=require("electron").remote,QRCode=require("qrcode"),request=require("request"),http=require("http"),https=require("https"),md5File=require("md5-file"),shell=require("electron").shell,DecompressZip=require("decompress-zip"),publicIp=require("public-ip"),path=require("path"),TelegramBot=require("node-telegram-bot-api"),Discord=require("discord.js"),isDevMode=process.execPath.match(/[\\/]electron/),dialog=electron.remote.dialog,isInit=!0,isSynced=!1,Steps={GET_COIN_LIST:-2,PREPARE:-1,START:0,GET_DATA:1,CHECK_WALLET_VERSION:2,DOWNLOAD_WALLET_VERSION:3,CHECK_PARAMS:4,DOWNLOAD_PARAMS:5,CHECK_BLOCKCHAIN:6,DOWNLOAD_BLOCKCHAIN:7,CHECK_DAEMON:9,DOWNLOAD_DAEMON:10,START_DAEMON:11,OPENING_WALLET:12,FINISH:13,CHECK_DATA_FOLDER:14,SHOW_POPUP:15,END:16},CheckType={SERVER:0,DAEMON:1},GetAllDataType={ALL:0,WITH_BALANCE:1,WITH_TRANSACTIONS:2,NONE:3},ScreenType={LOADING:0,OVERVIEW:1,SEND:2,SHIELD:3,ADDRESSES:4,TRANSACTIONS:5,MASTERNODES:6,MASTERNODES_CONFIG:7,APPS:8,EXCHANGES:9,SETTINGS:10,MASTERNODES_MAP:11},MsgType={ALERT:0,CONFIRMATION:1,DELETE:2,EDITMN:3,UBUNTU_VERSION:4,DAEMON_LOCATION:5,DEPENDENCIES:6,DEFAULT_SETTINGS:7,ADD_PEERS:8,DEBUG:9,GET_PEERS:10,SELECTCOIN:11,AUTO_DOWNLOAD_DAEMON:12,AUTO_DOWNLOAD_BLOCKCHAIN:13,LOADING_RESTART_WALLET:14,LOADING_DAEMON:15,CUSTOM_DATA:16,DATA_LOCATION:17,CONFIRMATION2:18,MASTERNODE_OPTION:19},SendType={NORMAL:0,SHIELD:1},apiStatus={},book={},shouldGetTransaction=!1,shouldGetWallet=!1,shouldGetAll=!0,localMNs=[],isRestarting=!1,ipc=electron.ipcRenderer,settings=void 0,coinList={},explorer="https://explorer.snowgem.org/",args=remote.process.argv,serverData=void 0,confData=void 0;function handleFunction(e){ipc.send("main-update-data",e)}function handleFunctionZcash(e){"getinfo"==e.key?ipc.send("main-get-data-zcash",e):"getwalletinfo"==e.key?ipc.send("main-get-data-zcash",e):"z_gettotalbalance"==e.key?ipc.send("main-get-data-zcash",e):"getblockchaininfo"==e.key?ipc.send("main-get-blockchain-info-zcash",e):"getblockheader"==e.key?ipc.send("main-get-block-header-zcash",e):"listtransactions"==e.key?ipc.send("main-list-transactions-zcash",e):"getaddressesbyaccount"==e.key?ipc.send("main-get-address-by-account-zcash",e):"listaddressgroupings"==e.key?ipc.send("main-list-address-groupings-zcash",e):"z_listaddresses"==e.key?ipc.send("main-z-list-address-zcash",e):"validateaddress"==e.key?ipc.send("main-validate-address-zcash",e):"z_validateaddress"==e.key?ipc.send("main-z-validate-address-zcash",e):"z_getbalance"==e.key?ipc.send("main-z-get-balance-zcash",e):"listreceivedbyaddress"==e.key?ipc.send("main-list-received-by-address-zcash",e):writeLog("zcash not supported")}function spawnErr(i){if(isDevMode){if(!i.includes("Cannot obtain a lock")){Error.stackTraceLimit=10;var e=function(e){var t=e.map(function(e){return e.toString()}).join("\n").split("\n")[1]+": "+i,a=t.split("/");if(t=a[0]+" "+a[a.length-1],"production"==process.env.NODE_ENV){var n=[i];ipc.send("main-spawn-error",n)}else{n=[t];ipc.send("main-spawn-error",n)}}}var t=new Error(i);StackTrace.fromError(t).then(e).catch(function(e){console.log(e.message)})}else{var a=[i];ipc.send("main-spawn-error",a)}}function spawnData(e){alert(e)}function getToolVersion(e){if(fs.existsSync(e)){var t=e+"/version.txt";return fs.existsSync(t)?fs.readFileSync(t,"utf8"):null}return fs.mkdirSync(e),null}function getParamsHome(e){var t=process.env["win32"==process.platform?"APPDATA":"HOME"];return"win32"==process.platform?(t+=e.params.win32,fs.existsSync(t)||fs.mkdirSync(t)):"linux"==process.platform?(t+=e.params.linux,fs.existsSync(t)||fs.mkdirSync(t)):"darwin"==process.platform&&(t+=e.params.darwin,fs.existsSync(t)||fs.mkdirSync(t)),t}function getHome(){return process.env["win32"==process.platform?"APPDATA":"HOME"]}function getWalletHome(e,t){var a=process.env["win32"==process.platform?"APPDATA":"HOME"];return"win32"==process.platform?(a+="\\ModernWallet",fs.existsSync(a)||fs.mkdirSync(a)):"linux"==process.platform?(a+="/.modernwallet",fs.existsSync(a)||fs.mkdirSync(a)):"darwin"==process.platform&&(a+="/Library/Application Support/ModernWallet",fs.existsSync(a)||fs.mkdirSync(a)),1==e||(a+="/"+t,fs.existsSync(a)||fs.mkdirSync(a)),a.replace(/\\/g,"/")}function getUserHome(e,t){var a=process.env["win32"==process.platform?"APPDATA":"HOME"];return"win32"==process.platform?(a+=e.data.win32,fs.existsSync(a)||fs.mkdirSync(a)):"linux"==process.platform?(a+=e.data.linux,fs.existsSync(a)||fs.mkdirSync(a)):"darwin"==process.platform&&(a+=e.data.darwin,fs.existsSync(a)||fs.mkdirSync(a)),-1<args.findIndex(function(e){return"-testnet"==e})&&(a+=null==e.testnetfolder?"/testnet3":e.testnetfolder),null!=t&&null!=t.datafolder&&t.datafolder!=a.replace(/\\/g,"/")?(fs.existsSync(t.datafolder)||fs.mkdirSync(t.datafolder),t.datafolder):a.replace(/\\/g,"/")}function makeRandom(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function backgroundProcess(e,t){var a=e.replace(/\\/g,"/"),n=t.slice();"-testnet"==n[0]&&n.splice(0,1),"z_getoperationstatus"==t[0]?t.splice(2,1):"-testnet"==t[0]&&"z_getoperationstatus"==t[1]?t.splice(3,1):"getdebug"==t[0]?t.splice(0,1):t[0].includes("validateaddress")&&2<t.length&&t.splice(2,1);var i={};if(fs.existsSync(a))try{if("linux"==process.platform||"darwin"==process.platform){var s=["+x",a];miningProcess.spawnSync("chmod",s)}(child=miningProcess.spawn(a,t)).stdout.on("data",function(e){var t=String(e);t.startsWith("Error")?(writeLog("stroutput error"),spawnErr(t)):null==i.value?(i.key=n[0],i.arg=n,i.value=t):i.value+=t}),child.stderr.on("data",function(e){var t=String(e);null==i.value?(i.key=n[0],i.arg=n,i.value=t):i.value+=t}),child.on("close",function(e){return handleFunction(i)})}catch(e){setTimeout(function(){writeLog("cannot start snowgem-cli"),spawnErr("Cannot start "+a+e.toString())},0)}else writeLog("cannot find snowgem-cli"),spawnErr("Cannot find "+a)}function backgroundProcessDaemon(e,t){var a=e.replace(/\\/g,"/");if(writeLog(t),fs.existsSync(a))try{if("linux"==process.platform||"darwin"==process.platform){var n=["+x",a];miningProcess.spawn("chmod",n)}(childDaemon=miningProcess.spawn(a,t,{detached:!0,stdio:["pipe","pipe","pipe"]})).unref();var i={status:!0};electron.ipcRenderer.send("main-loading-screen",i),childDaemon.stderr.pipe(process.stdout),childDaemon.stdout.on("data",function(e){var t=String(e);writeLog("strOutput"),t.startsWith("Error")&&(writeLog("stroutput error"),setTimeout(function(){spawnErr(t)},0))}),childDaemon.stderr.on("data",function(e){var t=String(e);setTimeout(function(){t.includes("Cannot obtain a lock on data directory")||(writeLog(t),spawnErr(t))},0)}),childDaemon.stdin.on("error",function(e){String(e);setTimeout(function(){writeLog("cannot start daemon 1"),spawnErr("Cannot start "+a)},0)})}catch(t){setTimeout(function(){writeLog("cannot start daemon 2"),spawnErr("Cannot start "+a+"\n"+String(t));var e={status:!1};electron.ipcRenderer.send("main-loading-screen",e)},0)}else{writeLog("cannot find daemon 2"),spawnErr("Cannot find "+a);i={status:!1};electron.ipcRenderer.send("main-loading-screen",i)}}function startDeamon(e){writeLog("\n\n\nSTART wallet"),backgroundProcessDaemon(settings.daemon,e)}function startCli(e,t){null==t&&(t="snowgem");var a=args.findIndex(function(e){return"-testnet"==e});if(null!=confData){port=-1<a?null!=confData.rpcport?confData.rpcport:serverData.testnet_rpcport:null!=confData.rpcport?confData.rpcport:serverData.rpcport;var n=e[0];e.splice(0,1),curlData(confData.rpcuser,confData.rpcpassword,port,n,e,t)}}function getFunctionName(e){var t=e.split("\n");return(t=(t=t[2].split("at "))[1].split(" ("))[0]}function writeLog(i){if(isDevMode){Error.stackTraceLimit=10;var e=new Error(i);StackTrace.fromError(e).then(function(e){var t=e.map(function(e){return e.toString()}).join("\n");try{JSON.stringify(i),n=(a=n.split("/"))[0]+" "+a[a.length-1],console.log(n),console.log(i)}catch(e){var a,n=t.split("\n")[1]+": ";n=(a=n.split("/"))[0]+" "+a[a.length-1]+i,console.log(n)}}).catch(function(e){console.log(e.message)})}else if(null!=settings&&settings.enablelog){var t=getWalletHome(!1,currentCoin)+"/debug.log";if(fs.existsSync(t))10<fs.statSync(t).size/1e6&&fs.unlink(t,function(e){if(e)throw e;console.log("Deleted!")});fs.appendFile(t,i+"\n",function(e){if(e)throw e;console.log("Saved!")})}}function startWallet(e){var t=require("path").join(require("os").homedir(),"desktop");t='-exportdir="'+t+'"',e.push(t),writeLog(e),startDeamon(e)}function stopWallet(){startCli(["stop"])}function checkWallet(){startCli(["help"])}function getAllData(e,t){var a=["getalldata",e];null!=t&&a.push(t),0==apiStatus.getalldata||null==apiStatus.getalldata?(writeLog(a),apiStatus.getalldata=!0,startCli(a)):writeLog("getting data, do not start another one")}function getPeerInfo(){var e=["getpeerinfo"];writeLog(e),startCli(e)}function getNetworkHeight(e){null==e&&(e="snowgem");var t=["getinfo"];writeLog(t),startCli(t,e)}function getBestBlockhash(e){null==e&&(e="snowgem");var t=["getblockchaininfo"];writeLog(t),startCli(t,e)}function getBestTime(e,t){null==t&&(t="snowgem");var a=["getblockheader",e];writeLog(a),startCli(a,t)}function zGetTotalBalance(e){null==e&&(e="snowgem");var t=["z_gettotalbalance"];writeLog(t),startCli(t,e)}function getWalletInfo(e){null==e&&(e="snowgem");var t=["getwalletinfo"];writeLog(t),startCli(t,e)}function getUnconfirmedBalance(){var e=["getunconfirmedbalance"];writeLog(e),startCli(e)}function checkConnections(){var e=["getconnectioncount"];writeLog(e),startCli(e)}function getAddressBalance(e,t){null==t&&(t="snowgem"),startCli(["z_getbalance",e],t)}function newAddress(){var e=["getnewaddress"];writeLog(e),startCli(e)}function newZAddress(e){var t=["z_getnewaddress"];null!=e?t.push("sapling"):t.push("sprout"),writeLog(t),startCli(t)}function getDebug(e){writeLog(e);var t=e.split(" ");t=t.filter(function(e){return""!=e});var a=["getdebug"];startCli(a=a.concat(t))}function exportPrivateKeys(e){var t=["z_exportwallet",e];writeLog(t),startCli(t)}function importPrivateKeys(e){var t=['z_importwallet "'+e+'"'];writeLog(t),startCli(t)}function exportPrivateKey(e){var t=["dumpprivkey",e];writeLog(t),startCli(t)}function z_exportPrivateKey(e){var t=["z_exportkey",e];writeLog(t),startCli(t)}function importPrivateKey(e,t,a){var n=["importprivkey",e];null!=t&&n.push(t),writeLog(n),startCli(n)}function z_importPrivateKey(e,t,a){var n=["z_importkey",e];writeLog(n),startCli(n)}function listTransactions(e,t){null==t&&(t="snowgem");var a=["listtransactions","",e];writeLog(a),startCli(a,t)}function listReceivedByAddress(e){null==e&&(e="snowgem");var t=["listreceivedbyaddress",999999999,!0,!0];writeLog(t),startCli(t,e)}function getAddressByAccount(e){null==e&&(e="snowgem");var t=["getaddressesbyaccount",""];writeLog(t),startCli(t,e)}function listAddressGroupings(e){null==e&&(e="snowgem");var t=["listaddressgroupings"];writeLog(t),startCli(t,e)}function zListAddress(e){null==e&&(e="snowgem");var t=["z_listaddresses"];writeLog(t),startCli(t,e)}function sendCoin(e,t,a,n,i){z_getoperationstatusData=z_sendmanyData=void 0;var s=[],r={};r.address=t,r.amount=parseFloat(a),s.push(r);var o=["z_sendmany",e,s,1,parseFloat(n)];writeLog(o),startCli(o)}function exec_sendCoin(e,t,a,n,i){z_getoperationstatusData=z_sendmanyData=void 0,writeLog(i),i==SendType.NORMAL?(writeLog("send coin normal"),sendCoin(e,t,a,n)):i==SendType.SHIELD&&(writeLog("shield coin"),shieldCoin(e,t,n))}function sendManyCoin(e,t,a){var n='"'+e+'" "[';t.forEach(function(e){var t=e.split(",");n+='{"address":"'+t[0]+'","amount":'+t[1]+"},"}),n=n.substring(0,n.Length-1);var i=["z_sendmany",n+=']"',"1",a];writeLog(i),startCli(i)}function shieldCoin(e,t,a){z_shieldcoinbaseData=void 0;var n=["z_shieldcoinbase",e,t,parseFloat(a),300];writeLog(n),startCli(n)}function verifyAddress(e,t,a){null==a&&(a="snowgem"),validateaddressData=void 0;var n=["validateaddress",e];n.push(t),startCli(n,a)}function verifyZAddress(e,t,a){null==a&&(a="snowgem"),validateaddressData=void 0;var n=["z_validateaddress",e];n.push(t),startCli(n,a)}function checkTransaction(e,t){var a=["z_getoperationstatus",[e=strstd(e)]];a.push(t),startCli(a)}function getTransaction(e){var t=["gettransaction",e];writeLog(t),startCli(t)}function getMNPrivKey(){masternodegenkeyData=void 0;var e=["masternode","genkey"];writeLog(e),startCli(e)}function getMNOutputs(){masternodeoutputsData=void 0;var e=["masternode","outputs"];writeLog(e),startCli(e)}function getMasternodeList(){masternodelistData=void 0;var e=["masternode","list"];writeLog(e),startCli(e)}function startMasternode(e){var t=["startmasternode","alias","false",e];writeLog(t),startCli(t)}function startAlias(e){var t=["startalias",e];writeLog(t),startCli(t)}function startAll(){var e=["startmasternode","many","false"];writeLog(e),startCli(e)}function readAddressBook(e,t,a){var n=getWalletHome(!1,a)+"/addressLabel.dat",i={};(fs.existsSync(n)&&(i=JSON.parse(fs.readFileSync(n,"utf8"))),e)&&(-1==Object.keys(i).findIndex(function(e){return"donation_address"==i[e]})&&(i[t.donation_address]="donation_address"));return i}function addAddressBook(e,t,a,n){book=readAddressBook(!0,a,n);var i=Object.keys(book),s={};if(Object.values(book).includes(e))return s.result=!1,s.error="Duplicate name",s;if(i.includes(t))return s.result=!1,s.error="Duplicate address",s;var r=getWalletHome(!1,n)+"/addressLabel.dat";return book[t]=e,delete book[a.donation_address],fs.writeFileSync(r,JSON.stringify(book)),s.result=!0,s.error="",s.book=book,s}function editAddressBook(e,t,a){var n=getWalletHome(!1,a)+"/addressLabel.dat";delete e[t.donation_address],fs.writeFileSync(n,JSON.stringify(e))}function updateWalletDic(e){var i=JSON.parse(JSON.stringify(e)),s=Object.keys(i);null!=this.book&&Object.keys(this.book).forEach(function(t){if(-1<s.findIndex(function(e){return e==t})){var e=i[t].amount,a=i[t].ismine;delete i[t];var n={};n.amount=e,n.ismine=a,i[t+" ("+this.book[t]+")"]=n}});return i}function getMasternodes(){var e=getUserHome(serverData,settings)+"/masternode.conf";if(fs.existsSync(e))return fs.readFileSync(e,"utf8")}function getConfig(e){var t=getUserHome(e,settings)+"/"+e.conf_file;if(fs.existsSync(t))return fs.readFileSync(t,"utf8")}function timeConverter(e){var t,a=new Date(1e3*e),n=("0"+a.getFullYear()).slice(-4),i=("0"+(a.getMonth()+1)).slice(-2),s=("0"+a.getDate()).slice(-2),r=("0"+a.getHours()).slice(-2),o=("0"+a.getMinutes()).slice(-2),l=("0"+a.getSeconds()).slice(-2);return null!=settings&&"1"==settings.datetime||null==settings||null==settings.datetime?t=n+"."+i+"."+s+" "+r+":"+o+":"+l:null!=settings&&"2"==settings.datetime&&(t=s+"."+i+"."+n+" "+r+":"+o+":"+l),t}function secondsToString(e){var t=parseInt(e/86400),a=parseInt(e%86400/3600),n=parseInt(e%3600/60);return(1<t?t+" days ":t+" day ")+("0"+a).slice(-2)+"h:"+("0"+n).slice(-2)+"m"}function currentTime(e){var t=parseInt(e/86400),a=parseInt(e%86400/3600),n=parseInt(e%3600/60);return(1<t?t+" days ":t+" day ")+("0"+a).slice(-2)+"h:"+("0"+n).slice(-2)+"m"}function strstd(e){return e.replace("\r\n","\n").replace("\n","")}function bestCopyEver(e){return Object.assign([],e)}function showTab(e,t){if(isInit&&t){var a=document.getElementsByClassName("tabcontent");for(i=0;i<a.length;i++)a[i].style.display="none";return null!=(n=document.getElementById(getKeyByValue(ScreenType,ScreenType.LOADING)))&&(n.style.display="block"),void $("#modalMenuBarAlert").modal()}$(".modal-backdrop").remove();var n;a=document.getElementsByClassName("tabcontent");for(i=0;i<a.length;i++)a[i].style.display="none";writeLog(e),writeLog(getKeyByValue(ScreenType,e)),null!=(n=document.getElementById(getKeyByValue(ScreenType,e)))&&(n.style.display="block"),e==ScreenType.OVERVIEW&&ipc.send("main-update-chart",void 0)}function getKeyByValue(t,a){return Object.keys(t).find(function(e){return t[e]==a})}function editMasternode(e,t,a,n,i,s,r,o){if(!o){var l=localMNs.findIndex(function(e){return e.alias==r});-1<l&&localMNs.splice(l,1)}var d={};d.status=0==s?"No":"Yes",d.alias=e,d.ip=t,d.privkey=a,d.txhash=n,d.txhashidx=i,localMNs.push(d),writeMasternodeFile(localMNs)}function removeMasternode(t){var e=localMNs.findIndex(function(e){return e.txhash==t});localMNs.splice(e,1),writeMasternodeFile(localMNs)}function writeMasternodeFile(e){var t="";e.sort(function(e,t){return e.alias>t.alias}),e.forEach(function(e){t+=("Yes"==e.status?"":"#")+e.alias+" "+e.ip+":16113 "+e.privkey+" "+e.txhash+" "+e.txhashidx+"\n"}),fs.writeFileSync(getUserHome(serverData,settings)+"/masternode.conf",t)}function correctAliasName(e){for(;e.startsWith("#");)e.splice(0,1);return e}function installDependencies(){var e;require("path"),electron.remote.app;if("linux"==process.platform?e=getWalletHome(!0)+"/setup.sh":"darwin"==process.platform&&(e=getHome()+"/setup.command"),fs.existsSync(e)&&fs.unlinkSync(e),"linux"==process.platform){var t="sudo apt-get install build-essential pkg-config libc6-dev m4 g++-multilib autoconf libtool ncurses-dev unzip git python python-zmq zlib1g-dev wget bsdmainutils automake curl";fs.writeFileSync(e,t)}else if("darwin"==process.platform){t="brew tap discoteq/discoteq; brew install flock; brew install autoconf; brew install autogen; brew install automake; brew install gcc5; brew install binutils; brew install protobuf; brew install coreutils; brew install wget";fs.writeFileSync(e,t)}writeLog("run chmod setup.sh");var a=["+x",e];return miningProcess.spawnSync("chmod",a),a=[e],miningProcess.spawnSync("sh",a,{detached:!0,shell:!0}),e}function saveSettings(t,e){var a=Object.keys(t),n=getWalletHome(!1,e)+"/settings.json",i={};if(fs.existsSync(n))try{i=JSON.parse(fs.readFileSync(n,"utf8"))}catch(e){}0<a.length&&a.forEach(function(e){i[e]=t[e]}),fs.writeFileSync(n,JSON.stringify(i)),readSettings(e)}function readSettings(e){writeLog("readSettings");var t=getWalletHome(!1,e)+"/settings.json",a={};try{a=JSON.parse(fs.readFileSync(t,"utf8"))}catch(e){}return a}function getCurrentCoin(){var e=getWalletHome(!0,currentCoin)+"/config.json",t={};try{t=JSON.parse(fs.readFileSync(e,"utf8"))}catch(e){}return null!=t.coinname?t.coinname:void 0}function saveCurrentCoin(e,t){var a=getWalletHome(!0,t)+"/config.json";fs.writeFileSync(a,e)}args.splice(0,1),"."==args[0]&&args.splice(0,1),window.$=window.jQuery=require("../../global/vendor/jquery/jquery.js"),window.Chartist=require("../../global/vendor/chartist/chartist.js"),$(document).on("click",'a[href^="https"]',function(e){e.preventDefault(),shell.openExternal(this.href)});var isRunning=function(e,n){var t="";switch(process.platform){case"win32":t="tasklist";break;case"darwin":t="ps -ax";break;case"linux":t="ps -A"}exec(t,function(e,t,a){n(t)})};function countOcurrences(e,a,t){if(t){var n=(e=e.replace("\r\n","\n")).split("\n"),i=0;return n.forEach(function(e){var t=e.split("/");t[t.length-1]==a&&(i+=1)}),i}var s=new RegExp(a,"gi");return(e.match(s)||[]).length}function getPrice(){var n="data.snowgem.org",i="rates.snowgem.org",s="/rates/index.html",r=require("request");r("https://"+n+s,function(e,t,a){null==t||200!=t.statusCode?r("https://"+i+s,function(e,t,a){null==t||200!=t.statusCode?r("http://"+n+s,function(e,t,a){null==t||200!=t.statusCode?r("http://"+i+s,function(e,t,a){null==t||200!=t.statusCode?setTimeout(getPrice,6e4):ipc.send("main-update-price",String(a))}):ipc.send("main-update-price",String(a))}):ipc.send("main-update-price",String(a))}):ipc.send("main-update-price",String(a))})}function filter_array(e){for(var t=-1,a=e?e.length:0,n=-1,i=[];++t<a;){var s=e[t];s&&(i[++n]=s)}return i}function readConfig(e){var t=getUserHome(e,settings)+"/"+e.conf_file,a={};fs.existsSync(t)&&filter_array(String(fs.readFileSync(t)).replace(new RegExp("\r?\n","g"),"\n").split("\n")).forEach(function(e){var t=e.split("=");2==t.length&&(a[t[0]]=t[1])});return a}function writeConfig(t){var e=Object.keys(t),a="";e.forEach(function(e){a+=e+"="+t[e]+"\n"});var n=getUserHome(serverData,settings)+"/"+serverData.conf_file;fs.writeFileSync(n,a)}function checkBlockchain(e,t){var a=getUserHome(e,settings),n=t.findIndex(function(e){return"-reindex"==e});return!(!fs.existsSync(a+"/blocks")||-1<n)}function checkNoticeDisplay(e,t,a){var n=getWalletHome(!1,currentCoin)+"/temp.dat",i=Math.round((new Date).getTime()/1e3);if(fs.existsSync(n)){var s=fs.readFileSync(n,"utf8");try{var r=(s=JSON.parse(s)).notice.findIndex(function(e){return e.type==t&&e.name==a});return!(-1<r)||!(parseInt(s.notice[r].time)+e.noticetimer>i&&parseInt(s.notice[r].time)<i)}catch(e){}}return!0}function saveNoticeDisplay(t,a){var e=getWalletHome(!1,currentCoin)+"/temp.dat",n=Math.round((new Date).getTime()/1e3);if(fs.existsSync(e)){var i=fs.readFileSync(e,"utf8");try{var s,r=(i=JSON.parse(i)).notice.findIndex(function(e){return e.type==t&&e.name==a});return-1<r?i.notice[r].time=n:((s={}).type=t,s.name=a,s.time=n,i.notice.push(s)),void fs.writeFileSync(e,JSON.stringify(i))}catch(e){}}i={notice:[]},(s={}).type=t,s.time=n,s.name=a,i.notice.push(s),fs.writeFileSync(e,JSON.stringify(i))}function clearBot(e){null!=bot&&("Telegram"==e?(bot.stopPolling(),bot=void 0):"Discord"==e&&(bot=void 0))}function initBot(e,t){console.log("Key = "+t),null==bot&&("Telegram"==e?((bot=new TelegramBot(t,{polling:{interval:1e3}})).on("message",function(e){console.log(e)}),bot.on("error",function(e){console.log("Error")}),bot.on("polling_error",function(e){console.log(e)}),bot.on("channel_post",function(e){console.log(e),replyMessage(e.text.toLowerCase(),e.chat.id)})):"Discord"==e&&((bot=new Discord.Client).login(t),bot.on("message",function(e){(console.log(e),e.author.bot)||replyMessage(e.content.toLowerCase(),e.author.id)})))}function replyMessage(e,a){var t=e.split(" ");console.log(t.length),console.log(t);var n=settings.botname+"\n";if("/"==t[0][0]){var i=t[0],s=t[1];if(s&&(s==settings.botname.toLowerCase()||"all"==s))if("/initbot"==i)settings.botid=a,saveSettings(settings,currentCoin),sendMessage(settings.bot,a,n+"Init successfully");else if("/noti"==i){"enable"==t[2].toLowerCase()?(settings.botnoti=!0,l="Enable notification"):(settings.botnoti=!1,l="Disable notification"),saveSettings(settings,currentCoin),sendMessage(settings.bot,a,n+l+" successfully")}else if("/shieldall"==i)if(isBotCmd=!0,t[2]){var r={shieldthreshold:0};r.shieldaddress=t[2],electron.ipcRenderer.send("main-execute-shield-all",r)}else createHelpMessage(i);else if("/send"==i)isBotCmd=!0;else if("/getaddrbook"==i){var o=[];addrBook.forEach(function(e){o.push(e.text)});var l=o.join(", ");sendMessage(settings.bot,a,n+l)}else if("/getaddr"==i){var d="";if(t[2]){addrBook.some(function(e){e.text!=t[2]||(d=e.value)});l=n+d;sendMessage(settings.bot,a,l)}else createHelpMessage(i)}else if("/stats"==i)sendMessage(settings.bot,a,createNotiData());else if("/mns"==i)sendMessage(settings.bot,a,createMNData());else if("/mndetail"==i)sendMessage(settings.bot,a,createMNData(t[2]));else if("/txs"==i)sendMessage(settings.bot,a,createTxData(parseInt(t[2])));else if("/price"==i)sendMessage(settings.bot,a,n+priceandsymbol);else if("/getid"==i)l=settings.botname+"\n"+a,sendMessage(settings.bot,a,l);else if("/name"==i)l=settings.botname+"\n",sendMessage(settings.bot,a,l);else if("/restart"==i)l=settings.botname+" will restart after 1 minute",sendMessage(settings.bot,a,l),restartPC();else if("/help"==i)if(3==t.length){l=createHelpMessage(t[2]);sendMessage(settings.bot,a,l)}else sendHelp(settings.botname+":\n",a);else"/ip"==i?publicIp.v4().then(function(e){localip=e;var t=settings.botname+" ip: "+localip;sendMessage(settings.bot,a,t)}):sendHelp(settings.botname+"\n",a)}else sendHelp(settings.botname+"\n",a)}function createNotiData(){return settings.botname+"\n"+JSON.stringify(balance,null,2)}function createMNData(t){var a=[];localMNs.forEach(function(e){null==t?a.push(e.alias):e.alias==t&&a.push(e)});var e=settings.botname+"\n";return 0==a.length&&null==t?e+"Cannot find any masternode in your wallet":0==a.length&&null!=t?e+"Cannot find "+t+" in your wallet":null==t?e+a.join(", "):e+JSON.stringify(a,null,2)}function createTxData(a){var n=[];return a<=0?a=5:5<a?a=5:isNaN(a)&&(a=1),transactions.some(function(e){var t={};n.length<a&&(t.no=n.length+1,t.direction=e.direction,t.date=e.date,t.address=e.address,t.amount=e.amount,t.validated=e.validated,t.confirmations=e.confirmations,n.push(t))}),settings.botname+"\n"+JSON.stringify(n,null,2)}function createHelpMessage(e){return""}function sendHelp(e,t){var a="";e&&(a+=e),a+="Command structure: <command> <walletname> <agruments>\n",a+="For example: /stats wallet1\n",a+="If you put 'all' to second parameter, all PCs will reply\n",a+="For example: /stats all\n\n",a+="Use '/help <walletname> <command> to display more detail\n",a+="Supported commands:\n",a+="/help - display help message\n",a+="/initbot - initialize bot\n",a+="/noti - enable/disable bot notication\n",a+="/stats - get wallet info\n",a+="/getaddrbook - get wallet name from book\n",a+="/getaddr - get wallet address from name\n",a+="/shieldall - shield all genmerated coin\n",a+="/send - send coin\n",a+="/mns - get masternode list\n",a+="/mndetail - get masternode detail\n",a+="/txs - get some latest transactions\n",a+="/price - get coin price\n",a+="/name - get bot name\n",a+="/getid - get user ID (Discord)\n",a+="/restart - restart PC\n",a+="/ip - get public ip address",sendMessage(settings.bot,t,a)}function sendBotReplyMsg(e){var t=settings.botname+"\n";sendMessage(settings.bot,settings.botid,t+e),isBotCmd=!1}function sendMessage(e,t,a){if(null!=bot)try{var n=require("dateformat"),i=new Date;formatted=n(i,"yyyy-mm-dd HH:MM:ss"),"\n"==(a=formatted+"\n"+a)[a.length-1]?a+="=========================":a+="\n=========================","Telegram"==e?bot.sendMessage(t,a):"Discord"==e&&bot.users.get(t).send(a)}catch(e){console.log("Send message error"),writeLog(e)}}function curlData(e,t,a,n,i,s){var r=[n.slice(0,n.length)];r=r.concat(i),"z_getoperationstatus"==n?i.splice(1,1):"getdebug"==n?(n=i[0],i.splice(0,1)):n.includes("validateaddress")&&1<i.length&&i.splice(1,1);var o={url:"http://localhost:"+a,method:"post",headers:{"content-type":"text/plain"},auth:{user:e,pass:t},body:JSON.stringify({jsonrpc:"1.0",id:"getdata",method:n,params:i})};request(o,function(e,t,a){if(e){(n={}).key=r[0],n.arg=r,n.value=e,"snowgem"==s?handleFunction(n):"zcash"==s?handleFunctionZcash(n):writeLog("curlData not supported")}else{var n={},i=a;try{i=JSON.parse(a)}catch(e){}n.key=r[0],n.arg=r,n.value=i,"snowgem"==s?handleFunction(n):"zcash"==s?handleFunctionZcash(n):writeLog("curlData not supported")}})}app.controller("MenuBarCtrl",["$scope","$http","$timeout",function(s,e,a){function t(){if(stopWallet(),checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result&&null!=helpData.errno){electron.ipcRenderer.send("main-reload",[])}else setTimeout(t,2e3);else setTimeout(t,500)}s.ScreenType={LOADING:0,OVERVIEW:1,SEND:2,SHIELD:3,ADDRESSES:4,TRANSACTIONS:5,MASTERNODES:6,MASTERNODES_CONFIG:7,APPS:8,EXCHANGES:9,SETTINGS:10,DEFAULT_SETTINGS:11,MASTERNODES_MAP:12},s.detail={hideMasternode:!0,hideCoinList:!0,coins:{},title:"",text:"",btn:""},s.detail.activeMasternode="site-menu-item has-sub",s.detail.activeApps="site-menu-item has-sub",s.detail.activeExchanges="site-menu-item has-sub",s.detail.coinSelect=void 0,s.menubarClick=function(e,t,a){if(null==a&&(a=!0),showTab(e,a),$(window).scrollTop(0),e==s.ScreenType.MASTERNODES||e==s.ScreenType.MASTERNODES_CONFIG||e==s.ScreenType.MASTERNODES_MAP){if("site-menu-item has-sub active"!=s.detail.activeMasternode){var n=document.getElementsByClassName("site-menu-item");for(i=0;i<n.length;i++)n[i].className=n[i].className.replace(" active",""),n[i].style.backgroundColor="";s.detail.activeMasternode="site-menu-item has-sub active"}}else s.detail.activeMasternode="site-menu-item has-sub";if(e==s.ScreenType.SNOWMINE){if("site-menu-item has-sub active"!=s.detail.activeApps){n=document.getElementsByClassName("site-menu-item");for(i=0;i<n.length;i++)n[i].className=n[i].className.replace(" active",""),n[i].style.backgroundColor="";s.detail.activeApps="site-menu-item has-sub active"}}else s.detail.activeApps="site-menu-item has-sub";e==s.ScreenType.MERCATOX?shell.openExternal(t):s.detail.activeExchanges="site-menu-item has-sub"},s.openExternal=function(e){shell.openExternal(e)},s.coinSelect=function(e){s.detail.title="Restart Wallet",s.detail.text="Do you want to select "+e+". Please wait until wallet is reloaded.",s.detail.btn="Restart Wallet",s.detail.coinSelect=e,$("#restartWalletMenubar").modal()},s.restartAction=function(){var e={};writeLog(s.detail.coinSelect),e.coinname=s.detail.coinSelect,saveCurrentCoin(JSON.stringify(e)),helpData=void 0,setTimeout(t,500)},electron.ipcRenderer.on("child-show-screen",function(e,t){var a=t.msg[0],n=t.msg[1];s.menubarClick(a,void 0,n)}),electron.ipcRenderer.on("child-update-settings",function(e,t){a(function(){null!=t.msg[2]&&null!=t.msg[2]&&(s.detail.hideMasternode=!t.msg[2].masternode,s.detail.currentCoin=currentCoin,writeLog(s.detail.hideMasternode)),null!=coinList.coins&&0<coinList.coins.length&&(s.detail.coins=coinList.coins,s.detail.hideCoinList=!1)},0)})}]),app.controller("NavBarCtrl",["$scope","$http","$timeout",function(r,e,o){r.detail={},r.detail.progress=0,r.detail.hideBar=!0,r.detail.connections=0,r.detail.currentblock="",r.detail.hideprice=!0,r.detail.banners=void 0,r.detail.showNoti=!1,r.refreshWallet=function(){electron.ipcRenderer.send("main-reload",[])},electron.ipcRenderer.on("child-update-loading",function(e,t){var a=t.msg,n=a.besttime,i=Math.floor(Date.now()/1e3),s=null==serverData.starttime?1511111234:serverData.starttime;o(function(){r.detail.progress=parseInt(n-s)/(i-s)*100,r.detail.width=r.detail.progress.toFixed(2)+"%",r.detail.synctitle=r.detail.width+" ("+timeConverter(n)+")",r.detail.connections=a.connections,r.detail.currentblock=null==a.block?"":", current block: data.block",i-n<1e3?(r.detail.hideBar=!0,isSynced=!0):(r.detail.hideBar=!1,isSynced=!1)},0)}),electron.ipcRenderer.on("child-notification-data",function(e,t){var a=t.msg;a=a.banner,o(function(){r.detail.notificationCounter=a.length,r.detail.banners=a,0<r.detail.notificationCounter?r.detail.showNoti=!0:r.detail.showNoti=!1},0)}),electron.ipcRenderer.on("child-update-price",function(e,a){o(function(){1==r.detail.hideprice&&null!=serverData&&"SnowGem"==serverData.coinname&&(r.detail.hideprice=!1),null==settings.currency&&(settings.currency="USD",settings.symbol="$");try{var t=JSON.parse(a.msg);t.some(function(e){if(e.code==settings.currency)return r.detail.pricechange=t[1].pricechange,r.detail.price=parseFloat(e.rate),priceandsymbol=r.detail.priceandsymbol=settings.symbol+r.detail.price,void setTimeout(getPrice,6e4)})}catch(e){setTimeout(getPrice,6e4)}},0)})}]),app.controller("SiteGridMenuCtrl",["$scope","$http","$timeout",function(e,t,a){e.ScreenType={LOADING:0,OVERVIEW:1,SEND:2,SHIELD:3,ADDRESSES:4,TRANSACTIONS:5,MASTERNODES:6,MASTERNODE_CONFIG:7,SNOWMINE:8,MERCATOX:9,SETTINGS:10},e.menubarClick=function(e){showTab(e,!0)}}]),app.controller("MenuBarFooterCtrl",["$scope","$http","$timeout",function(e,t,a){e.ScreenType={LOADING:0,OVERVIEW:1,SEND:2,SHIELD:3,ADDRESSES:4,TRANSACTIONS:5,MASTERNODES:6,MASTERNODE_CONFIG:7,SNOWMINE:8,MERCATOX:9,SETTINGS:10},e.menubarClick=function(e){showTab(e,null==settings||null==serverData||null==confData)}}]),app.controller("BottomCtrl",["$scope","$http","$timeout",function(t,e,a){t.detail={},setInterval(function(){a(function(){var e=Date.now()/1e3;t.detail.currenttime=timeConverter(e)},0)},250)}]),app.controller("AddressesCtrl",["$scope","$http","$timeout",function(l,e,n){var t,a;l.addresses=[],l.selectedList={},l.selectedListClone={},l.importList=[],l.detail={},l.privKeyList={},l.detail.current={},l.detail.privKeyText="Get Privatekey",l.detail.enableButton=!0,l.detail.alertText="",l.detail.enableGetPrivKey=!1,l.detail.enableImportKey=!0,l.detail.hideZeroAddress=!1,l.detail.showGetPrivKey=!1,l.detail.sapling=!1,l.detail.hideZeroAddressText,l.detail.currentCoin,l.detail.shieldAddress,l.detail.importWithRescan=!0,l.detail.importPrivKeyText="Import Privatekeys";var i,s,r=void 0,o=1,d=!1,c=!1;function u(e,t,a){ScreenType.ADDRESSES;n(function(){l.detail.title=t,l.detail.alertText=a,$(e).modal()},0)}function p(){1==o?(l.detail.importPrivKeyText="Importing.",o+=1):2==o?(l.detail.importPrivKeyText="Importing..",o+=1):3==o&&(l.detail.importPrivKeyText="Importing...",o=1)}function g(e,s){var r=e.from,t=Object.keys(r),o=1;n(function(){l.addresses=[],t.forEach(function(e){var t={};t.no=o,t.copy="";var a,n=e.split(" ");if(t.address=e.split(" ")[0],1<n.length){var i=e.split(t.address+" ")[1];i.startsWith("(")&&(i=i.slice(1,i.length-1)),i.endsWith(")")&&(i=i.splice(0,i.length-2)),t.book=i}(a=e.startsWith("z")?"private":"public",0==r[e].ismine&&(a="read-only"),t.type=a,t.amount=r[e].amount,1!=s||0!=t.amount)&&(l.addresses.push(t),-1==Object.keys(l.selectedList).findIndex(function(e){return e===t.address})&&"read-only"!=t.type&&(l.selectedList[t.address]=!1),o+=1)}),l.detail.enableButton=!0},0)}function f(){var e=Object.keys(l.selectedListClone)[0];delete l.selectedListClone[e],e.startsWith("z")?z_exportPrivateKey(e.split(" ")[0]):exportPrivateKey(e.split(" ")[0])}function m(t){n(function(){if(null!=t&&null!=t.msg.value.error){var e="Cannot import "+t.msg.arg[1]+"\n\n";e+=t.msg.value.error.message,c=!0,u("#modalAddressError","Error!!!",e)}else h()},0)}function h(){if(0==l.importList.length)return shouldGetAll=!0,l.detail.enableImportKey=!0,u("#modalAddressNoti","","Done"),clearTimeout(r),r=void 0,void(l.detail.importPrivKeyText="Import Privatekeys");l.detail.enableImportKey=!1;var e=l.importList[0];l.importList.splice(0,1),writeLog(l.importList.length),e.startsWith("K")||e.startsWith("L")?importPrivateKey(e,"",l.detail.importWithRescan):z_importPrivateKey(e,l.detail.importWithRescan,0)}l.deleteBook=function(e,t){n(function(){var e=l.detail.bookKeys.findIndex(function(e){return e==t});l.detail.bookKeys.splice(e,1),delete l.detail.book[t]},0)},l.cancelAddressBookAction=function(){n(function(){l.detail.book=readAddressBook(!1,serverData,currentCoin),l.detail.bookKeys=Object.keys(l.detail.book)},0)},l.editAddressBookAction=function(){editAddressBook(l.detail.book,serverData,currentCoin),book=readAddressBook(!0,serverData,currentCoin),shouldGetWallet=!0},l.editAddressBook=function(){l.detail.book=readAddressBook(!1,serverData,currentCoin),l.detail.bookKeys=Object.keys(l.detail.book),l.detail.bookKeys.sort(),u("#modalEditAddressBook","Edit Address Book")},l.bookChange=function(e,t){n(function(){l.detail.book[t]=e,editAddressBook(l.detail.book,serverData,currentCoin),book=readAddressBook(!0,serverData,currentCoin),shouldGetWallet=!0},0)},l.select=function(t,e){var a=l.addresses.findIndex(function(e){return e.address===t});if("read-only"==l.addresses[a].type)l.selectedList[t]=!1,u("#modalAddressNoti","Alert!!!","Can not select read-only address");else{l.selectedList[t]=e;var n=Object.keys(l.selectedList),i=0;n.forEach(function(e){1==l.selectedList[e]&&(i+=1)}),1<=i?(l.detail.showGetPrivKey=!0,l.detail.enableGetPrivKey=!0,l.detail.privKeyText=2<=i?"Get Privatekeys":"Get Privatekey"):l.detail.showGetPrivKey=!1}},l.selectAllClick=function(a){Object.keys(l.selectedList).forEach(function(t){var e=l.addresses.findIndex(function(e){return e.address===t});"read-only"!=l.addresses[e].type&&(l.selectedList[t]=a)}),a?(l.detail.privKeyText="Get Privatekeys",l.detail.showGetPrivKey=!0,l.detail.enableGetPrivKey=!0):l.detail.showGetPrivKey=!1},l.newAddress=function(){t=!1,u("#modalAddressNewAddress","Create new public address")},l.newPrivateAddress=function(e){t=!0,a=e,u("#modalAddressNewAddress","Create new private address")},l.createAddress=function(e){if(console.log(l.detail.addressName),null!=e){if(e.preventDefault(),13!==e.keyCode)return;$("#modalAddressNewAddress").modal("hide")}l.detail.addressName?(book=readAddressBook(!0,serverData,currentCoin),Object.values(book).includes(l.detail.addressName)?u("#modalAddressNoti","FAILED!!!","Duplicate name"):(s=l.detail.addressName,l.detail.addressName="",0==t?newAddress():newZAddress(a),shouldGetAll=!0,l.detail.enableButton=!1)):u("#modalAddressNoti","FAILED!!!","Name could not be empty")},l.getPrivKey=function(){l.privKeyList={},Object.keys(l.selectedList).forEach(function(e){1==l.selectedList[e]&&(l.selectedListClone[e]=!0)}),l.detail.enableGetPrivKey=!1,f()},l.importPrivKey=function(){d=!0,u("#modalAddressNoti","Attention","Importing address takes long time, your wallet information will not be updated until this progress is finished.\nIt may take more than 10 minutes")},l.closeAlertAction=function(){d?($("#importPrivatekeys").modal(),d=!1):c&&(setTimeout(h,1e3),c=!1)},l.importAction=function(){l.importList=l.detail.privKeysImport.replace("\r\n","\n").split("\n"),l.detail.privKeysImport=void 0,0<l.importList.length&&(null==r&&(r=setInterval(p,1e3)),m())},l.newAddressBook=function(){l.detail.current.name="",l.detail.current.address="",l.detail.current.readonly=!1,u("#modalNewAddressBook","Add New Address Book")},l.viewBook=function(e,t){l.detail.current.name=t,l.detail.current.address=e,l.detail.current.readonly=!0,u("#modalNewAddressBook","View Address Book")},l.createAction=function(e,t){l.detail.current.address=void 0,l.detail.current.name=void 0,function(t,e){writeLog(e);var a=l.addresses.findIndex(function(e){return e.address==t});writeLog(a),-1<a&&(l.addresses[a].book=e)}(t,e);var a=addAddressBook(e,t,serverData,currentCoin);1==a.result?(book=a.book,shouldGetWallet=!0):u("#modalAddressNoti","FAILED!!!",a.error)},l.faq=function(){shell.openExternal("https://snowgem.org/faq")},l.viewQrcode=function(t){var e=document.getElementById("qrcode");QRCode.toCanvas(e,t,{width:256},function(e){e&&console.error(e),u("#modalQrCode",t)})},l.hideZeroAddressClick=function(){l.detail.hideZeroAddress=!l.detail.hideZeroAddress,0==l.detail.hideZeroAddress||null==l.detail.hideZeroAddress?l.detail.hideZeroAddressText="Hide Zero Balance":l.detail.hideZeroAddressText="Show Zero Balance";var e=readSettings(l.detail.currentCoin);e.hidezeroaddress=l.detail.hideZeroAddress,g(i,l.detail.hideZeroAddress),saveSettings(e,l.detail.currentCoin)},l.multipleShieldClick=function(){null==l.detail.shieldAddress||null==l.detail.shieldAddress?u("#modalAddressNoti","Alert!!!","Please select private address in Settings before using this feature"):u("#shieldAllConfirmationAddr","Are you sure?","Do you want to shield all generated coin to "+l.detail.shieldAddress)},l.shieldAllAction=function(){var t={};t.privateAddr=l.detail.shieldAddress,t.shieldAddress=[],Object.keys(l.selectedList).forEach(function(e){1==l.selectedList[e]&&t.shieldAddress.push(e)}),electron.ipcRenderer.send("main-execute-multiple-shield",t),showTab(ScreenType.SHIELD,!1),$(window).scrollTop(0)},electron.ipcRenderer.on("child-update-address",function(e,t){g(i=t.msg,l.detail.hideZeroAddress)}),electron.ipcRenderer.on("child-get-new-address",function(e,t){var a=addAddressBook(s,t.msg.result,serverData,currentCoin);book=a.book,shouldGetWallet=!0,u("#modalAddressNoti","New Address",t.msg.result)}),electron.ipcRenderer.on("child-dump-priv-key",function(e,t){var i=t.msg;n(function(){l.privKeyList[i.arg[1]]=i.value.result;var t,e=Object.keys(l.selectedList),a=Object.keys(l.privKeyList),n=(t=0,e.forEach(function(e){1==l.selectedList[e]&&(t+=1)}),t);writeLog(n),writeLog(a.length),n==a.length?(l.detail.privatekeys=JSON.stringify(l.privKeyList,null,2),l.detail.enableGetPrivKey=!0,$("#privKeyModal").modal()):f()})},0),electron.ipcRenderer.on("child-import-priv-key",function(e,t){m(t)}),electron.ipcRenderer.on("child-update-settings",function(e,t){n(function(){null!=t.msg[0]&&null!=t.msg[0]&&(l.detail.hideZeroAddress=t.msg[0].hidezeroaddress,l.detail.shieldAddress=t.msg[0].shieldaddress,0==l.detail.hideZeroAddress||null==l.detail.hideZeroAddress?l.detail.hideZeroAddressText="Hide Zero Balance":l.detail.hideZeroAddressText="Show Zero Balance"),null!=t.msg[1]&&null!=t.msg[1]&&(l.detail.sapling=t.msg[2].sapling),l.detail.currentCoin=currentCoin},0)})}]),app.controller("LoadingCtrl",["$scope","$http","$timeout",function(g,e,u){var f="data.snowgem.org",m="rates.snowgem.org",h=Steps.GET_COIN_LIST,v=void 0;g.detail={};var t,p=void 0;g.server=void 0,g.port=void 0,g.detail.disableProgressbar=!0,g.detail.linuxVersion=void 0,g.detail.noiticeSelectUbuntu=!0,g.detail.popup={},g.currentProcess="Preparing",g.visible=!0,g.oss=["Ubuntu-16.04","Ubuntu-18.04","Others"],g.detail.background="../../assets/images/xsg-loading5.png";var a=path.dirname(electron.remote.app.getPath("exe"));function y(e,t,a,n){u(function(){g.detail.title=null==n?"Alert!!!":n,g.detail.text=t,g.detail.btnText=null==a?"Apply":a,e==MsgType.ALERT?$("#modalLoadingAlert").modal():e==MsgType.CONFIRMATION?$("#modalLoadingNewVersion").modal():e==MsgType.UBUNTU_VERSION?$("#modalUbuntuVersion").modal():e==MsgType.DAEMON_LOCATION?$("#modalDaemonLocation").modal():e==MsgType.DEPENDENCIES?$("#modalDependencies").modal():e==MsgType.SELECTCOIN?$("#selectCoinAlert").modal():e==MsgType.AUTO_DOWNLOAD_DAEMON?$("#autoDownloadDaemonModal").modal():e==MsgType.AUTO_DOWNLOAD_BLOCKCHAIN?$("#autoDownloadBlockchainModal").modal():e==MsgType.LOADING_DAEMON?$("#modalLoadingDaemon").modal():e==MsgType.CUSTOM_DATA?$("#customDataDir").modal():e==MsgType.DATA_LOCATION?$("#modalDataLocation").modal():e==MsgType.MASTERNODE_OPTION&&$("#masternodeOption").modal()})}function A(e){u(function(){g.currentProcess=e},0)}function D(e){switch(e){case Steps.GET_COIN_LIST:A("Getting coin list...");var t=getCurrentCoin();null!=t&&(currentCoin=t),null!=(settings=readSettings(currentCoin)).background&&(g.detail.background=settings.background),null!=settings.bot&&null!=settings.apikey&&initBot(settings.bot,settings.apikey);var a=[settings,confData,serverData];ipc.send("main-update-settings",a),function(){var n="/modernwallet/coinlist.json";(isDevMode||betaTest)&&(n="/modernwallet/coinlist_beta.json");var i=require("request");i("https://"+f+n,function(e,t,a){console.log("error:",e),null==t||200!=t.statusCode?i("https://"+m+n,function(e,t,a){console.log("error:",e),null==t||200!=t.statusCode?i("http://"+f+n,function(e,t,a){console.log("error:",e),null==t||200!=t.statusCode?y(MsgType.ALERT,"Could not get data from server"):(g.server=f,g.port=80,coinList=JSON.parse(String(a)),D(h=Steps.PREPARE))}):(g.server=m,g.port=443,coinList=JSON.parse(String(a)),D(h=Steps.PREPARE))}):(g.server=f,g.port=443,coinList=JSON.parse(String(a)),D(h=Steps.PREPARE))})}();break;case Steps.PREPARE:writeLog(currentCoin),g.detail.coins=coinList.coins;var n=coinList.coins.findIndex(function(e){return e.name==currentCoin});null==currentCoin||-1==n?(writeLog("Show alert"),y(MsgType.SELECTCOIN,"","","Select Coin")):D(h=Steps.GET_DATA);break;case Steps.GET_DATA:A("Getting server data..."),function(){var e="/modernwallet/"+(null==currentCoin?"SnowGem":currentCoin)+"/version.txt";(isDevMode||betaTest)&&(e="/modernwallet/beta/"+(null==currentCoin?"SnowGem":currentCoin)+"/version.txt");var t=require("request");443==g.port?t("https://"+g.server+e,function(e,t,a){null==t?y(MsgType.ALERT,"Could not get data from server"):(serverData=JSON.parse(String(a)),D(h=Steps.SHOW_POPUP))}):80==g.port&&t("http://"+g.server+e,function(e,t,a){null==t?y(MsgType.ALERT,"Could not get data from server"):(serverData=JSON.parse(String(a)),D(h=Steps.SHOW_POPUP))})}();break;case Steps.SHOW_POPUP:var i={};i.popup=serverData.popup,i.banner=serverData.banner,electron.ipcRenderer.send("main-notification-data",i),D(h=Steps.START);break;case Steps.START:if(serverData.walletversion=coinList.version.walletversion,serverData.detail=coinList.version.detail,"win32"!=process.platform){var s=getUserHome(serverData,settings)+(null==serverData.wallet?"/wallet.dat":"/"+serverData.wallet);if(fs.existsSync(s))C();else{s=installDependencies(),a=[MsgType.DEPENDENCIES,"Please run "+s+" to install dependencies","Notice!!!"];y(MsgType.DEPENDENCIES,"Please run "+s+" to install dependencies","Notice!!!")}}else C();break;case Steps.CHECK_WALLET_VERSION:A("Checking wallet version...");var r=(p=serverData.walletversion,appVersion<p);D(h=r?Steps.DOWNLOAD_WALLET_VERSION:Steps.CHECK_PARAMS);break;case Steps.DOWNLOAD_WALLET_VERSION:A("Checking wallet version..."),c=serverData.walletversion,u=serverData.detail,y(MsgType.CONFIRMATION,null==u?"Do you want to download?":u,"Download","Version "+c+" is availabled");break;case Steps.CHECK_PARAMS:A("Checking params..."),function(){writeLog("check params");var t=getParamsHome(serverData),n=serverData.paramfiles;if(null!=n&&null!=n){var i=Object.keys(n),a=!0;if(i.some(function(e){fs.existsSync(t+"/"+e)||(a=!1)}),a){var s=0;i.some(function(a){md5File(t+"/"+a,function(e,t){if(e)writeLog("check MD5 error");else{if(writeLog("hash = "+t),writeLog("server hash = "+n[a]),t.toLowerCase()!=n[a].toLowerCase())return writeLog("key not correct"),shouldDownload=!0,void D(h=Steps.DOWNLOAD_PARAMS);++s==i.length&&(writeLog("params are ok"),D(h=Steps.CHECK_DAEMON))}})})}else writeLog("file not existed"),D(h=Steps.DOWNLOAD_PARAMS)}else D(h=Steps.CHECK_DAEMON)}();break;case Steps.DOWNLOAD_PARAMS:A("Downloading params..."),w(serverData.paramsurl,getParamsHome(serverData),"params");break;case Steps.CHECK_DAEMON:A("Checking daemon..."),1==settings.autoupdatedaemon?S():0==settings.autoupdatedaemon?D(h=Steps.CHECK_DATA_FOLDER):null==settings.autoupdatedaemon&&y(MsgType.AUTO_DOWNLOAD_DAEMON,"Do you want to download daemon file automatically?",""," ");break;case Steps.DOWNLOAD_DAEMON:A("Downloading daemon..."),isRunning("daemon",function(e){1<=countOcurrences(e,"daemon")&&stopWallet()}),"win32"==process.platform?w(serverData.windowsdaemonurl,getWalletHome(!1,currentCoin),"daemon"):"linux"==process.platform?y(MsgType.UBUNTU_VERSION,"","OK","Select a version from dropdown"):w(serverData.macdaemonurl,getWalletHome(!1,currentCoin),"daemon");break;case Steps.CHECK_DATA_FOLDER:A("Checkling data folder..."),null==settings.datafolder?y(MsgType.CUSTOM_DATA,"Do you want to use default data location?",""," "):D(h=Steps.CHECK_BLOCKCHAIN);break;case Steps.CHECK_BLOCKCHAIN:A("Checking blockchain...");var o=getWalletHome(!0)+"/commands.txt";if(fs.existsSync(o)){var l=fs.readFileSync(o,"utf8");fsextra.removeSync(o),args=args.concat(l.split("\n"))}checkBlockchain(serverData,args)?D(h=Steps.START_DAEMON):y(MsgType.AUTO_DOWNLOAD_BLOCKCHAIN,"Do you want to download blockchain automatically? (This action will speed up your syncing process)",""," ");break;case Steps.DOWNLOAD_BLOCKCHAIN:A("Downloading blockchain...");var d=getUserHome(serverData,settings);fs.existsSync(d+"/blocks")&&fsextra.removeSync(d+"/blocks"),fs.existsSync(d+"/chainstate")&&fsextra.removeSync(d+"/chainstate"),fs.existsSync(d+"/sporks")&&fsextra.removeSync(d+"/sporks"),1==confData.txindex?null!=serverData.blockchain&&null!=serverData.blockchain.index&&T(serverData.blockchain.index,getUserHome(serverData,settings),"blockchain.zip"):null!=serverData.blockchain&&null!=serverData.blockchain.noindex&&T(serverData.blockchain.noindex,getUserHome(serverData,settings),"blockchain.zip");break;case Steps.START_DAEMON:A("Starting daemon..."),null!=settings.datafolder&&args.push("-datadir="+settings.datafolder),a=[settings,confData,serverData],ipc.send("main-update-settings",a),startWallet(args);break;case Steps.OPENING_WALLET:setTimeout(b,2e3);break;case Steps.FINISH:A("Finishing..."),function(e,t){writeLog("wallet is started");var a=[e,t];electron.ipcRenderer.send("main-execute-timer",a),settings.autoshield&&electron.ipcRenderer.send("main-execute-shield-all",settings)}(currentCoin,serverData);break;case Steps.END:writeLog("End\n\n\n"),clearInterval(v);a=[];ipc.send("main-self-close",a)}var c,u,p}function b(){checkWallet(),null!=helpData&&null!=helpData?null!=helpData.result?(writeLog("go to finish"),D(h=Steps.FINISH)):(h!=Steps.END&&setTimeout(b,2e3),A(helpData.error.message)):h!=Steps.END&&setTimeout(b,2e3)}function w(e,n,t){writeLog("downloading "+(e=e.replace("https:\\","https://"))),writeLog(n),fs.existsSync(n)||fs.mkdirSync(n);var r=n+"/"+t+".zip";!function(e,t){var i=0,s=0;u(function(){g.detail.disableProgressbar=!1},0),p=request({method:"GET",uri:e});var a=fs.createWriteStream(t);p.pipe(a).on("finish",function(){!0,u(function(){g.detail.disableProgressbar=!0},0),setTimeout(function(){A("Extracting file"),u(function(){if(g.detail.disableProgressbar=!1,g.detail.progress=0,g.detail.width="0%",i==s){var e=new DecompressZip(r);e.on("error",function(e){u(function(){fs.unlinkSync(r),h==Steps.DOWNLOAD_PARAMS?y(MsgType.ALERT,"Download param files error, please restart wallet"):h==Steps.DOWNLOAD_DAEMON?y(MsgType.ALERT,"Download new daemon files error, please restart wallet"):h==Steps.DOWNLOAD_BLOCKCHAIN&&y(MsgType.ALERT,"Download blockchain error, please restart wallet"),g.detail.disableProgressbar=!0},0)}),e.on("extract",function(e){u(function(){g.detail.disableProgressbar=!0,fs.unlinkSync(r),h==Steps.DOWNLOAD_BLOCKCHAIN?(h=Steps.START_DAEMON,setTimeout(D,2e3,h)):D(h=Steps.CHECK_DAEMON)},0)}),e.on("progress",function(t,a){u(function(){var e=(parseFloat(t+1)/a*100).toFixed(2);A("Extracting file ("+e+"%)"),g.detail.progress=e,g.detail.width=e+"%"},0)}),e.extract({path:n})}else g.detail.disableProgressbar=!0},0)},3e3)}),p.on("response",function(e){s=parseInt(e.headers["content-length"])}),p.on("data",function(e){var t,a,n;i+=e.length,n=100*(t=i)/(a=s),u(function(){A("Downloading params ("+(t/1024/1024).toFixed(2)+"MB/ "+(a/1024/1024).toFixed(2)+"MB)"),g.detail.progress=n,g.detail.width=n.toFixed(2)+"%"},0)}),p.on("error",function(e){fs.unlink(r),u(function(){g.detail.disableProgressbar=!0},0),y(MsgType.ALERT,"Downloading error, restarting wallet")})}(e,r),writeLog(r)}function T(l,d,c){if(0<l.length){filesCopy=l.slice(0),url=filesCopy[0].replace("https:\\","https://"),filesCopy.splice(0,1),writeLog("downloading "+url),writeLog(d);var e=url.split("/");name=e[e.length-1],fs.existsSync(d)||fs.mkdirSync(d);var t=d+"/"+name;!function a(e,t,s){var r=0;var o=0;u(function(){g.detail.disableProgressbar=!1},0);p=request({method:"GET",uri:e});var n=fs.createWriteStream(t);var i=p.pipe(n);i.on("finish",function(){if(0==filesCopy.length)!0,u(function(){g.detail.disableProgressbar=!0},0),setTimeout(function(){!function(){A("Joining files");var e=require("split-file"),t=d+"/"+c,a=[];l.forEach(function(e){var t=e.split("/");a.push(d+"/"+t[t.length-1])}),e.mergeFiles(a,t).then(function(){A("Extracting file"),u(function(){g.detail.disableProgressbar=!1,g.detail.progress=0,g.detail.width="0%";var e=new DecompressZip(t);e.on("error",function(e){u(function(){fs.unlinkSync(t),l.forEach(function(e){fs.unlinkSync(e)}),y(MsgType.ALERT,"Download blockchain error, please restart wallet"),g.detail.disableProgressbar=!0},0)}),e.on("extract",function(e){u(function(){g.detail.disableProgressbar=!0,fs.unlinkSync(t),h==Steps.DOWNLOAD_BLOCKCHAIN&&(h=Steps.START_DAEMON,setTimeout(D,2e3,h))},0)}),e.on("progress",function(t,a){u(function(){var e=(parseFloat(t+1)/a*100).toFixed(2);A("Extracting file ("+e+"%)"),g.detail.progress=e,g.detail.width=e+"%"},0)}),e.extract({path:d})},0)}).catch(function(e){console.log("Error: ",e)})}()},3e3);else{url=filesCopy[0].replace("https:\\","https://"),filesCopy.splice(0,1),writeLog("downloading "+url),writeLog(d);var e=url.split("/");s=e[e.length-1];var t=d+"/"+s;a(url,t,s)}});p.on("response",function(e){o=parseInt(e.headers["content-length"])});p.on("data",function(e){var t,a,n,i;r+=e.length,n=s,i=100*(t=r)/(a=o),u(function(){A("Downloading "+n+" ("+(t/1024/1024).toFixed(2)+"MB/ "+(a/1024/1024).toFixed(2)+"MB)"),g.detail.progress=i,g.detail.width=i.toFixed(2)+"%"},0)});p.on("error",function(e){u(function(){g.detail.disableProgressbar=!0,l.forEach(function(e){fs.unlinkSync(e)})},0),y(MsgType.ALERT,"Downloading blockchain error, restarting wallet")})}(url,t,name),writeLog(t)}else h=Steps.START_DAEMON,setTimeout(D,2e3,h)}function S(){writeLog("check daemon"),fs.existsSync(settings.daemon)?md5File(settings.daemon,function(e,t){var a;e?writeLog("check MD5 error"):("win32"==process.platform?a=serverData.checksum.windowsdaemon:"linux"==process.platform?a=serverData.checksum.linuxdaemon:"darwin"==process.platform&&(a=serverData.checksum.macdaemon),writeLog("daemon hash = "+t),writeLog("checksum = "+a),t.toLowerCase()!=a.toLowerCase()?(writeLog("daemon checksum is not correct"),D(h=Steps.DOWNLOAD_DAEMON)):D(h=Steps.CHECK_DATA_FOLDER))}):(writeLog("file not existed"),D(h=Steps.DOWNLOAD_DAEMON))}function n(){if(checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result){electron.ipcRenderer.send("main-reload",[])}else setTimeout(n,500);else setTimeout(n,500)}function C(){writeLog("not running"),A("Starting..."),null==(confData=readConfig(serverData)).rpcuser?(confData.rpcuser=makeRandom(30),confData.rpcpassword=makeRandom(30),y(MsgType.MASTERNODE_OPTION,"Do you have any plan to setup masternodes on this wallet?",""," ")):i()}function i(){(settings=readSettings(currentCoin)).autoupdatedaemon&&(settings.daemon=getWalletHome(!1,currentCoin)+"/"+serverData.daemon,"win32"==process.platform&&(settings.daemon+=".exe")),settings.autostart?t.enable():t.disable(),null==settings.enablelog&&(settings.enablelog=!0),null==settings.transactionschart&&(settings.transactionschart=!0),null!=settings.background&&(g.detail.background=settings.background);var e=[settings,confData,serverData];ipc.send("main-update-settings",e),book=readAddressBook(!0,serverData,currentCoin),e=[],D(h=Steps.CHECK_WALLET_VERSION)}"win32"==process.platform?t=new autoLaunch({name:"ModernWallet",path:a.replace("/","\\")+"\\ModernWallet.exe"}):"linux"==process.platform?t=new autoLaunch({name:"ModernWallet",path:a+"/ModernWallet"}):"darwin"==process.platform&&(t=new autoLaunch({name:"ModernWallet",path:"/Applications/ModernWallet.app"})),getPrice(),g.closePopup=function(){D(h=Steps.START)},D(h),electron.ipcRenderer.on("child-loading-screen",function(e,t){var a=t.msg;writeLog(a),1==a.status?D(h=Steps.OPENING_WALLET):D(h=Steps.END)}),electron.ipcRenderer.on("child-stop-daemon",function(e,t){stopWallet()}),electron.ipcRenderer.on("child-spawn-error",function(e,t){y(MsgType.LOADING_DAEMON,t.msg[0])}),electron.ipcRenderer.on("child-process-data",function(e,t){var a=t.msg;if(writeLog(a.key),"getalldata"==a.key)getalldata=a,electron.ipcRenderer.send("main-summary-data",getalldata);else if("help"==a.key)helpData=a.value;else if("getinfo"==a.key)getinfoData=a.value;else if("z_sendmany"==a.key)z_sendmanyData=a.value,electron.ipcRenderer.send("main-send-coin",z_sendmanyData);else if("z_getoperationstatus"==a.key){z_getoperationstatusData=a.value,(n=a.arg)[2]==SendType.NORMAL?electron.ipcRenderer.send("main-check-transaction",z_getoperationstatusData):n[2]==SendType.SHIELD&&electron.ipcRenderer.send("main-check-transaction-shield",z_getoperationstatusData)}else if("validateaddress"==a.key){var n=[];validateaddressData=a.value,n.push(a.value),n.push(a.arg),electron.ipcRenderer.send("main-verify-address",n)}else if("z_validateaddress"==a.key){n=[];validateaddressData=a.value,n.push(a.value),n.push(a.arg),electron.ipcRenderer.send("main-verify-zaddress",n)}else"z_shieldcoinbase"==a.key?(z_shieldcoinbaseData=a,electron.ipcRenderer.send("main-shield-coin",z_shieldcoinbaseData)):"masternode"==a.key?"list"==a.arg[1]?(masternodelistData=a.value,electron.ipcRenderer.send("main-masternode-list",masternodelistData)):"outputs"==a.arg[1]?(masternodeoutputsData=a.value,electron.ipcRenderer.send("main-masternode-outputs",masternodeoutputsData)):"genkey"==a.arg[1]&&(masternodegenkeyData=a.value,electron.ipcRenderer.send("main-masternode-genkey",masternodegenkeyData)):"startmasternode"==a.key?"alias"==a.arg[1]?(startmasternodealiasData=a.value,electron.ipcRenderer.send("main-start-masternode",startmasternodealiasData)):"many"==a.arg[1]&&(startmasternodemanyData=a.value):"dumpprivkey"==a.key||"z_exportkey"==a.key?(dumpprivkeyData=a,electron.ipcRenderer.send("main-dump-priv-key",dumpprivkeyData)):"importprivkey"==a.key||"z_importkey"==a.key?(importprivkeyData=a,electron.ipcRenderer.send("main-import-priv-key",importprivkeyData)):"startalias"==a.key?(startaliasData=a.value,electron.ipcRenderer.send("main-start-alias",startaliasData)):"getpeerinfo"==a.key?(getPeerInfoData=a.value,electron.ipcRenderer.send("main-get-peer-info",getPeerInfoData)):"getdebug"==a.key?(getDebugData=a.value,electron.ipcRenderer.send("main-get-debug",getDebugData)):"getnewaddress"==a.key||"z_getnewaddress"==a.key?(getNewAddressData=a.value,electron.ipcRenderer.send("main-get-new-address",getNewAddressData)):"stop"==a.key||writeLog("not supported "+a.key)}),g.autoDownload=function(){settings.autoupdatedaemon=!0,settings.daemon=getWalletHome(!1,currentCoin)+"/"+serverData.daemon,"win32"==process.platform&&(settings.daemon+=".exe"),saveSettings(settings,currentCoin),S()},g.noAutoDownload=function(){y(MsgType.DAEMON_LOCATION,"","","Select Binary Files")},g.autoDownloadBlockchain=function(){var e=args.findIndex(function(e){return"-reindex"==e});args.splice(e,1),D(h=Steps.DOWNLOAD_BLOCKCHAIN)},g.noAutoDownloadBlockchain=function(){D(h=Steps.START_DAEMON)},g.selectLinux=function(e){null==e?g.detail.noiticeSelectUbuntu=!1:($("#modalUbuntuVersion").modal("hide"),null!=serverData[e]?w(serverData[e],getWalletHome(!1,currentCoin),"daemon"):y(MsgType.DAEMON_LOCATION,"","","Select Binary Files"))},g.restartAction=function(){null!=serverData&&null!=serverData.daemon&&isRunning(serverData.daemon,function(e){1<=countOcurrences(e,serverData.daemon)&&stopWallet()}),helpData=void 0,setTimeout(n,500)},g.daemonAction=function(){var e={};g.detail.text.includes("Cannot obtain a lock on data directory")?e.status=!0:e.status=!1,electron.ipcRenderer.send("main-loading-screen",e)},g.dependenciesAction=function(){C()},electron.ipcRenderer.on("main-dependencies",function(){C()}),g.btnAction=function(){writeLog("go to download page"),electron.shell.openExternal(serverData.walleturl);ipc.send("main-self-close",[])},g.cancelAction=function(){D(h=Steps.CHECK_PARAMS)},g.openDaemon=function(){var e;g.detail.disableSelectDaemon=!0,"win32"==process.platform?e={filters:[{name:"Exe Files",extensions:["exe"]}],properties:["openFile"]}:"linux"!=process.platform&&"darwin"!=process.platform||(e={properties:["openFile"]}),dialog.showOpenDialog(e,function(e){u(function(){g.detail.disableSelectDaemon=!1,void 0===e?writeLog("No file selected"):document.getElementById("daemon-file").value=g.detail.daemonLocation=e[0]},0)})},g.openCli=function(){var e;"win32"==process.platform?e={filters:[{name:"Exe Files",extensions:["exe"]}],properties:["openFile"]}:"linux"!=process.platform&&"darwin"!=process.platform||(e={properties:["openFile"]}),dialog.showOpenDialog(e,function(e){void 0===e?writeLog("No file selected"):document.getElementById("cli-file").value=g.detail.cliLocation=e[0]})},g.applyLocationAction=function(){if(""==g.detail.daemonLocation||null==g.detail.daemonLocation)y(MsgType.ALERT,"Daemon location cannot be empty");else{var e=readSettings(currentCoin);e.daemon=g.detail.daemonLocation.replace("\\","/"),settings.autoupdatedaemon=!1,e.autoupdatedaemon=!1,writeLog(JSON.stringify(e)),saveSettings(e,currentCoin);electron.ipcRenderer.send("main-reload",[])}},g.cancelLocationAction=function(){y(MsgType.AUTO_DOWNLOAD_DAEMON,"Do you want to download daemon file automatically?",""," ")},g.selectCoin=function(e){currentCoin=e;var t={};t.coinname=currentCoin,saveCurrentCoin(JSON.stringify(t),currentCoin),D(h=Steps.GET_COIN_LIST)},g.noCustomData=function(){settings.datafolder=getUserHome(serverData,void 0),saveSettings(settings,currentCoin),D(h=Steps.CHECK_BLOCKCHAIN)},g.customData=function(){y(MsgType.DATA_LOCATION,"","","Select Data Directory")},g.openDataDir=function(){g.detail.disableSelectDirectory=!0;dialog.showOpenDialog({properties:["openDirectory"]},function(e){u(function(){g.detail.disableSelectDirectory=!1,void 0===e?writeLog("No folder selected"):document.getElementById("data-dir").value=g.detail.dataLocation=e[0]},0)})},g.applyCustomDataAction=function(){if(""==g.detail.dataLocation||null==g.detail.dataLocation)y(MsgType.ALERT,"Data folder cannot be empty");else{var e=readSettings(currentCoin);e.datafolder=g.detail.dataLocation.replace("\\","/"),writeLog(JSON.stringify(e)),saveSettings(e,currentCoin);electron.ipcRenderer.send("main-reload",[])}},g.canceCustomDataAction=function(){y(MsgType.CUSTOM_DATA,"Do you want to use default data location?",""," ")},g.indexData=function(){confData.txindex=1,writeConfig(confData),i()},g.noindexData=function(){confData.txindex=0,writeConfig(confData),i()}}]),app.controller("MasternodesCtrl",["$scope","$http","$timeout",function(s,e,i){function r(e,t,a){var n=[ScreenType.MASTERNODES,!0];electron.ipcRenderer.send("main-show-screen",n),i(function(){s.detail.title=null==a?"Alert!!!":a,s.detail.text=t,e==MsgType.ALERT?$("#modalMasternodesAlert").modal():e==MsgType.CONFIRMATION?$("#modalMasternodesConfirmation").modal():e==MsgType.DELETE?$("#modalMasternodesDelete").modal():e==MsgType.EDITMN&&$("#modalMasternodesEdit").modal()})}function o(){writeLog("populateLocalMN");var e=getMasternodes();if(s.localMNs=[],null!=e&&null!=e){var t=(e=e.replace("\r\n","\n")).split("\n");t=t.filter(function(e){return!e.isEmpty()});var i=1;t.forEach(function(e){var t={};if(!e.startsWith("# ")){var a=e.split(" ");5<=(a=a.filter(function(e){return""!=e})).length&&(t.no=i,a[0].startsWith("#")?(t.status="No",t.alias=a[0].split("#")[1]):(t.status="Yes",t.alias=a[0]),t.ip=a[1].split(":")[0],t.privkey=a[2],t.txhash=a[3],t.txhashidx=a[4],t.rank="-",t.activetime="-",t.lastseen="-",i+=1);var n=s.localMNs.findIndex(function(e){return e.txhash===t.txhash});-1==n?s.localMNs.push(t):s.localMNs[n].alias!=t.alias&&(s.localMNs[n].alias=t.alias,s.localMNs[n].status=t.status)}}),s.localMNs.sort(function(e,t){return e.alias>t.alias}),localMNs=JSON.parse(angular.toJson(s.localMNs))}}function l(e){var t=$("<textarea>");$("body").append(t),t.val(e).select(),document.execCommand("copy"),t.remove()}function a(e){if(checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result||null==helpData.result){if(e){var t=getUserHome(serverData,settings)+"/mncache.dat";fs.unlinkSync(t)}electron.ipcRenderer.send("main-reload",[])}else setTimeout(a,500);else setTimeout(a,500)}s.localMNs=[],s.networkMNs=[],s.selectedList={},s.selectedListClone={},s.detail={},s.detail.current={},s.visible=!1,s.detail.disableActions=!0,String.prototype.isEmpty=function(){return 0===this.length||!this.trim()},s.select=function(e,t){var a,n=Object.keys(s.selectedList),i=(a=0,n.forEach(function(e){1==s.selectedList[e]&&(a+=1)}),a);0<i?(s.detail.disableActions=!1,s.detail.disableEdit=1<i):s.detail.disableActions=!0},s.editMasternode=function(e){if(writeLog("edit masternode"),!e){var t=Object.keys(s.selectedList),a=t.findIndex(function(e){return 1==s.selectedList[e]}),n=t[a];-1<a&&(a=s.localMNs.findIndex(function(e){return e.txhash==n}),s.detail.current.alias=s.detail.current.oldalias=s.localMNs[a].alias,s.detail.current.ip=s.localMNs[a].ip.split(":")[0],s.detail.current.privkey=s.localMNs[a].privkey,s.detail.current.txhash=s.localMNs[a].txhash,s.detail.current.txhashidx=parseInt(s.localMNs[a].txhashidx),r(MsgType.EDITMN,"","Edit "+s.localMNs[a].alias))}},s.editAction=function(){writeLog("edit");var e=Object.keys(s.selectedList),a=bestCopyEver(s.localMNs);e.forEach(function(t){if(s.selectedList[t]){var e=a.findIndex(function(e){return e.txhash==t});a.splice(e,1)}}),index=a.findIndex(function(e){return e.alias==s.detail.current.alias}),-1<index?r(MsgType.ALERT,"Duplicate alias name"):(index=a.findIndex(function(e){return strstd(e.privkey)==strstd(s.detail.current.privkey)}),-1<index?r(MsgType.ALERT,"Duplicate private key"):(index=a.findIndex(function(e){return e.txhash==s.detail.current.txhash}),-1<index?r(MsgType.ALERT,"Duplicate transaction hash"):(editMasternode(correctAliasName(s.detail.current.alias),s.detail.current.ip,s.detail.current.privkey,s.detail.current.txhash,s.detail.current.txhashidx,!0,s.detail.current.oldalias,!1),o(),r(MsgType.CONFIRMATION,"Restart wallet to apply new configuration?","Notice"))))},s.copyAliasMasternode=function(e){if(writeLog("copyAliasMasternode"),!e){var t=Object.keys(s.selectedList),a=t.findIndex(function(e){return 1==s.selectedList[e]}),n=t[a];if(-1<a)a=s.localMNs.findIndex(function(e){return e.txhash==n}),l(s.localMNs[a].alias+" "+s.localMNs[a].ip+":16113 "+s.localMNs[a].privkey+" "+s.localMNs[a].txhash+" "+s.localMNs[a].txhashidx),r(MsgType.ALERT,"Copied","")}},s.restartAction=function(){isRestarting=!0,stopWallet(),helpData=void 0,setTimeout(a,500,!1)},s.copyConfig=function(e){if(!e){var t=[];t.push("rpcuser="+makeRandom(40)),t.push("rpcpassword="+makeRandom(40)),t.push("addnode=dnsseed1.snowgem.org"),t.push("addnode=dnsseed2.snowgem.org"),t.push("addnode=dnsseed3.snowgem.org"),t.push("addnode=explorer.snowgem.org"),t.push("addnode=insight.snowgem.org"),t.push("addnode=insight.snowgem.org");var a=Object.keys(s.selectedList),n=a.findIndex(function(e){return 1==s.selectedList[e]}),i=a[n];-1<n&&(n=s.localMNs.findIndex(function(e){return e.txhash==i}),t.push("masternodeaddr="+s.localMNs[n].ip+":16113"),t.push("externalip="+s.localMNs[n].ip+":16113"),t.push("masternodeprivkey="+s.localMNs[n].privkey),t.push("masternode=1"),t.push("txindex=1")),l(t=t.join("\n")),r(MsgType.ALERT,"Copied","")}},s.lockUnlockMasternode=function(){writeLog("lockUnlockMasternode");var e=Object.keys(s.selectedList);if(2<=e.length){var a=!1;e.forEach(function(t){s.selectedList[t]&&(index=s.localMNs.findIndex(function(e){return e.txhash==t}),writeLog(JSON.stringify(s.localMNs[index])),"No"==s.localMNs[index].status)&&(a=!0)}),e.forEach(function(t){s.selectedList[t]&&(index=s.localMNs.findIndex(function(e){return e.txhash==t}),editMasternode(correctAliasName(s.localMNs[index].alias),s.localMNs[index].ip,s.localMNs[index].privkey,s.localMNs[index].txhash,s.localMNs[index].txhashidx,a,s.localMNs[index].alias,!1))}),o(),r(MsgType.CONFIRMATION,"Restart wallet to apply new configuration?","Notice")}else if(0<e.length&&e.length<2){a=!1;e.forEach(function(t){s.selectedList[t]&&(index=s.localMNs.findIndex(function(e){return e.txhash==t}),"No"==s.localMNs[index].status&&(a=!0),editMasternode(correctAliasName(s.localMNs[index].alias),s.localMNs[index].ip,s.localMNs[index].privkey,s.localMNs[index].txhash,s.localMNs[index].txhashidx,a,s.localMNs[index].alias,!1))}),o(),r(MsgType.CONFIRMATION,"Restart wallet to apply new configuration?","Notice")}},s.deleteMasternode=function(){var e=Object.keys(s.selectedList),a="";e.forEach(function(t){if(s.selectedList[t]){var e=s.localMNs.findIndex(function(e){return e.txhash==t});a+=s.localMNs[e].alias+" "}a.substring(0,a.length-2)}),r(MsgType.DELETE,"Do you want to delete: "+a+"?","Notice")},s.deletedAction=function(){Object.keys(s.selectedList).forEach(function(t){if(s.selectedList[t]){var e=s.localMNs.findIndex(function(e){return e.txhash==t});removeMasternode(s.localMNs[e].txhash)}}),o(),r(MsgType.CONFIRMATION,"Restart wallet to apply new configuration?","Notice")},s.viewDetail=function(e){r(MsgType.ALERT,JSON.stringify(e,null,2),"Masternode Details")},s.startMasternode=function(){writeLog("startMasternode");var e=Object.keys(s.selectedList),t=void 0;e.some(function(e){1!=s.selectedList[e]||(t=e)});var a=s.localMNs.findIndex(function(e){return e.txhash==t});startMasternode(s.localMNs[a].alias)},s.clearCache=function(){isRestarting=!0,stopWallet(),helpData=void 0,setTimeout(a,500,!0)},s.faq=function(){shell.openExternal("https://snowgem.org/faq")},electron.ipcRenderer.on("child-masternode-list",function(e,t){var a,n=t.msg;o(),writeLog("total MNs: "+(a=n).result.length),s.networkMNs=[],a.result.forEach(function(e){var t={};t.rank=e.rank,t.ip=e.ip,t.txhash=e.txhash,t.status=e.status,t.addr=e.addr,t.version=e.version,t.activetime=secondsToString(e.activetime),t.lastseen=timeConverter(e.lastseen),t.value=e,s.networkMNs.push(t)}),0==s.networkMNs.length?setTimeout(getMasternodeList,5e3):(s.localMNs.forEach(function(t){var e=s.networkMNs.findIndex(function(e){return e.txhash===t.txhash});-1<e&&(t.rank=s.networkMNs[e].rank,t.activetime=s.networkMNs[e].activetime,t.lastseen=s.networkMNs[e].lastseen)}),setTimeout(getMasternodeList,6e4))}),electron.ipcRenderer.on("child-execute-timer",function(e,t){writeLog("execute masternode list timer"),serverData.masternode&&setTimeout(getMasternodeList,3e3)}),electron.ipcRenderer.on("child-start-masternode",function(e,t){var a=t.msg.result;if(writeLog(a),"successful"==a.detail[0].result){var n=Object.keys(s.selectedList)[0],i=localMNs.findIndex(function(e){return e.txhash==n});startAlias(s.localMNs[i].alias)}else r(MsgType.ALERT,a.detail[0].error,"FAILED!!!")}),electron.ipcRenderer.on("child-start-alias",function(e,t){var a=t.msg;"Successfully started alias"!=a.result.result?r(MsgType.ALERT,a.result.result,"FAILED!!!"):r(MsgType.ALERT,a.result.result,"SUCCESS!!!")})}]),app.controller("MasternodesConfigCtrl",["$scope","$http","$timeout",function(i,e,s){function c(e,t,a){var n=[ScreenType.MASTERNODES_CONFIG,!0];electron.ipcRenderer.send("main-show-screen",n),s(function(){i.detail.title=null==a?"Alert!!!":a,i.detail.text=t,e==MsgType.ALERT?$("#modalMasternodeConfigAlert").modal():e==MsgType.CONFIRMATION&&$("#modalMasternodeConfigConfirmation").modal()},0)}function t(){if(checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result){electron.ipcRenderer.send("main-reload",[])}else setTimeout(t,500);else setTimeout(t,500)}i.detail={},i.detail.outputs=[],i.detail.mnData=[],i.detail.alias=void 0,i.detail.ip=void 0,i.detail.privkey=void 0,i.detail.transactionID=void 0,i.detail.index=void 0,i.detail.showNewMasternodeData=!1,i.detail.btnDisabled=!1,isGetPrivKey=!1,i.generate=function(){i.detail.showNewMasternodeData=!1,i.detail.btnDisabled=!0,isGetPrivKey=!1,getMNOutputs()},i.restartAction=function(){isRestarting=!0,stopWallet(),helpData=void 0,setTimeout(t,500)},i.getPrivKey=function(){isGetPrivKey=!0,getMNPrivKey()},i.setupMasternode=function(){null!=i.detail.alias?i.detail.alias.includes(" ")?c(MsgType.ALERT,"Alias name must not contain whitespace"):null!=i.detail.ip?null!=i.detail.privkey?null!=i.detail.transactionID?null!=i.detail.index?function(e,t,a,n,i,s,r,o){writeLog(JSON.stringify(localMNs));var l=e;e.startsWith("#")&&(l=e.substring(1));var d=localMNs.findIndex(function(e){return e.alias==l});-1<d?c(MsgType.ALERT,"Duplicate alias name"):-1<(d=localMNs.findIndex(function(e){return strstd(e.privkey)==strstd(a)}))?c(MsgType.ALERT,"Duplicate private key"):-1<(d=localMNs.findIndex(function(e){return e.txhash==n}))?c(MsgType.ALERT,"Duplicate transaction hash"):(editMasternode(correctAliasName(e),t,a,n,i,s,"",!0),c(MsgType.CONFIRMATION,"Restart wallet to apply new configuration?","Notice"))}(i.detail.alias,i.detail.ip,i.detail.privkey,i.detail.transactionID,i.detail.index):c(MsgType.ALERT,"Transaction Index could not be empty"):c(MsgType.ALERT,"Transaction could not be empty"):c(MsgType.ALERT,"Private key could not be empty"):c(MsgType.ALERT,"IP address could not be empty"):c(MsgType.ALERT,"Alias name could not be empty")},i.faq=function(){shell.openExternal("https://snowgem.org/faq")},electron.ipcRenderer.on("child-masternode-outputs",function(e,t){var a=t.msg.result;writeLog(JSON.stringify(localMNs)),s(function(){a.forEach(function(t){-1==localMNs.findIndex(function(e){return e.txhash==t.txhash})&&i.detail.outputs.push(t)}),0==i.detail.outputs.length?(i.detail.btnDisabled=!1,c(MsgType.ALERT,"You don't have any new output")):getMNPrivKey()},0)}),electron.ipcRenderer.on("child-masternode-genkey",function(e,t){var a=t.msg;writeLog(a),s(function(){if(isGetPrivKey)c(MsgType.ALERT,a.result,"Masternode Key");else{var e={};e.privkey=a.result,e.txhash=i.detail.outputs[0].txhash,e.txhashidx=i.detail.outputs[0].outputidx,e.no=i.detail.mnData.length+1,i.detail.mnData.push(e),i.detail.outputs.splice(0,1),0<i.detail.outputs.length?getMNPrivKey():(i.detail.showNewMasternodeData=!0,i.detail.btnDisabled=!1)}},0)})}]),app.controller("OverviewCtrl",["$scope","$http","$timeout",function(g,e,f){g.balances={totalCoins:-1,transparentCoins:-1,privateCoins:-1,unconfirmedCoins:-1,lockedCoins:-1,immatureCoins:-1};var a,t=0;isInit=!0,g.bestHeight=void 0,g.visible=!1,g.startingText="Good morning!",g.detail={},g.detail.sticker="XSG",g.detail.transactionschart=!1,g.detail.transactionTime=1,g.rawData={},g.walletData={},g.dataChange={},g.detail.banner={},g.detail.chartText="";var o=void 0;function n(){var e=new Date,t=parseInt(e.getHours());g.startingText=0<=t&&t<12?"Good morning!":12<=t&&t<18?"Good afternoon!":"Good evening!"}function m(){if(writeLog("get wallet data"),getNetworkHeight(),null==apiStatus||null==apiStatus.getalldata||0==apiStatus.getalldata){if(null!=getinfoData){15==t&&(shouldGetWallet=!0);var e=getinfoData.result.blocks;1==shouldGetAll||g.bestHeight+1<=e?(g.detail.transactionschart?getAllData(GetAllDataType.ALL,parseInt(g.detail.transactionTime)):getAllData(GetAllDataType.ALL),shouldGetTransaction=shouldGetWallet=shouldGetAll=!1):shouldGetTransaction?g.detail.transactionschart?getAllData(GetAllDataType.WITH_TRANSACTIONS,parseInt(g.detail.transactionTime)):getAllData(GetAllDataType.WITH_TRANSACTIONS):1==shouldGetWallet?(getAllData(GetAllDataType.WITH_BALANCE),shouldGetWallet=!1,t=0):getAllData(GetAllDataType.NONE),g.bestHeight=e,writeLog("$scope.bestHeight = "+g.bestHeight+", height = "+e)}else g.detail.transactionschart?getAllData(GetAllDataType.ALL,parseInt(g.detail.transactionTime)):getAllData(GetAllDataType.ALL);t+=1}}function l(){writeLog("get wallet data"),g.dataChange.getinfo=void 0,g.dataChange.getwalletinfo=void 0,g.dataChange.z_gettotalbalance=void 0,getNetworkHeight(serverData.cointype),getWalletInfo(serverData.cointype),zGetTotalBalance(serverData.cointype)}function s(){0<a.length?(verifyAddress(a[0],void 0,serverData.cointype),a.splice(0,1)):(a=Object.keys(g.rawData.addressbalance),r())}function r(){0<a.length?(getAddressBalance(a[0],serverData.cointype),a.splice(0,1)):function(e,t,a){writeLog("processRawData"),g.balances.totalCoins=e.totalbalance,g.balances.transparentCoins=e.transparentbalance,g.balances.remainingvalue=null==e.remainingValue?0:e.remainingValue,g.balances.privateCoins=null==e.privatebalance?0:e.privatebalance,g.balances.unconfirmedCoins=e.unconfirmedbalance,g.balances.lockedCoins=null==e.lockedbalance?0:e.lockedbalance,g.balances.immatureCoins=e.immaturebalance,balance=g.balances;var n={};n.besttime=e.besttime,n.connections=e.connectionCount,electron.ipcRenderer.send("main-update-loading",n),electron.ipcRenderer.send("main-update-locked-coin",e.remainingValue);var i=updateWalletDic(e.addressbalance),s={};s.from=i,s.book=book,electron.ipcRenderer.send("main-update-address",s),electron.ipcRenderer.send("main-update-send",s),electron.ipcRenderer.send("main-update-shield",s),(listtransactions=e.listtransactions).reverse();var r={};if(r.data=listtransactions,r.time=1,electron.ipcRenderer.send("main-update-transactions",r),isInit){var o=[ScreenType.OVERVIEW,!0];electron.ipcRenderer.send("main-show-screen",o),isInit=!1}apiStatus.getwalletdata=!1,shouldGetAll=!1,setTimeout(l,1e4)}(g.rawData)}n(),setInterval(n,6e4),electron.ipcRenderer.on("child-execute-timer",function(e,t){writeLog("execute screen summary timer"),"snowgem"==t.msg[1].cointype?setTimeout(m,3e3):"zcash"==t.msg[1].cointype&&setTimeout(l,3e3)}),electron.ipcRenderer.on("child-summary-data",function(e,t){var a,n,i;if("getalldata"==(o=t.msg).key)if(null!=o.value.result||isRestarting){if(!isRestarting){var s;if(null!=(s=o.value.result)){if(s=s,(p=o.arg)[1]==GetAllDataType.WITH_TRANSACTIONS)(listtransactions=s.listtransactions).reverse(),(o={}).data=listtransactions,o.time=g.detail.transactionTime,electron.ipcRenderer.send("main-update-transactions",o);else if(p[1]==GetAllDataType.WITH_BALANCE){walletDic=updateWalletDic(walletDic=s.addressbalance[0]),(r={}).from=walletDic,r.book=book,electron.ipcRenderer.send("main-update-address",r),electron.ipcRenderer.send("main-update-send",r),electron.ipcRenderer.send("main-update-shield",r)}else if(p[1]==GetAllDataType.ALL){var r,o;(listtransactions=s.listtransactions).reverse(),walletDic=updateWalletDic(walletDic=s.addressbalance[0]),(r={}).from=walletDic,r.book=book,electron.ipcRenderer.send("main-update-address",r),electron.ipcRenderer.send("main-update-send",r),electron.ipcRenderer.send("main-update-shield",r),(o={}).data=listtransactions,o.time=g.detail.transactionTime,electron.ipcRenderer.send("main-update-transactions",o)}var l=s.besttime,d=s.connectionCount,c=s.block,u={};if(u.besttime=l,u.connections=d,u.block=c,electron.ipcRenderer.send("main-update-loading",u),f(function(){g.balances.totalCoins=s.totalbalance,g.balances.remainingvalue=s.remainingValue,g.balances.transparentCoins=s.transparentbalance,g.balances.privateCoins=s.privatebalance,g.balances.unconfirmedCoins=s.unconfirmedbalance,g.balances.lockedCoins=s.lockedbalance,g.balances.immatureCoins=s.immaturebalance,balance=g.balances,null!=lastBalance&&lastBalance.totalCoins==g.balances.totalCoins&&lastBalance.transparentCoins==g.balances.transparentCoins&&lastBalance.privateCoins==g.balances.privateCoins&&lastBalance.unconfirmedCoins==g.balances.unconfirmedCoins&&lastBalance.lockedCoins==g.balances.lockedCoins&&lastBalance.immatureCoins==g.balances.immatureCoins||(lastBalance=g.balances,p[1]!=GetAllDataType.ALL&&(shouldGetAll=!0)),electron.ipcRenderer.send("main-update-locked-coin",s.remainingValue)},0),isInit){var p=[ScreenType.OVERVIEW,!0];electron.ipcRenderer.send("main-show-screen",p),isInit=!1}}apiStatus.getalldata=!1,setTimeout(m,1e4)}}else a=MsgType.ALERT,n=o.value.error.message,g.detail.title=null==i?"Alert!!!":i,g.detail.text=n,a==MsgType.ALERT&&$("#modalOverviewAlert").modal()}),g.closeOverviewBanner=function(){g.detail.showBanner=!1},electron.ipcRenderer.on("child-update-settings",function(e,t){f(function(){null!=t.msg[2]&&null!=t.msg[2]&&(g.detail.sticker=t.msg[2].sticker,g.detail.coin=t.msg[2].coinname,g.detail.transactionschart=null==t.msg[0].transactionschart||t.msg[0].transactionschart,g.detail.hideLockedCard=!(null!=t.msg[2].lockedcoin&&t.msg[2].lockedcoin)),null!=t.msg[0]&&null!=t.msg[0]&&(g.detail.transactionTime=null==t.msg[0].transactionstime?1:t.msg[0].transactionstime)},0)}),electron.ipcRenderer.on("child-update-transactions-time",function(e,t){var n,s,r;n=t.msg,s=n.data,r=1,f(function(){if(g.detail.chartText="Your transactions in the last 24 hours",2==n.time?(r=7,g.detail.chartText="Your transactions in the last 7 days"):3==n.time?(r=30,g.detail.chartText="Your transactions in the last month"):4==n.time?(r=90,g.detail.chartText="Your transactions in the last quarter"):5==n.time&&(r=365,g.detail.chartText="Your transactions in the last year"),null!=s&&g.detail.transactionschart){g.detail.dataChart=[];var e=Math.round((new Date).getTime()/1e3),t=e-24*r*60*60;for(t=1800*(parseInt(t/1800/r)+1)*r,e=1800*(parseInt(e/1800/r)+1)*r,i=t;i<e;i+=1800*r){var a={};a.time=1e3*i,a.in=0,a.out=0,g.detail.dataChart.push(a)}g.detail.dataChart.totalIn=0,g.detail.dataChart.totalOut=0,s.forEach(function(e){var t=1800*parseInt(e.time/1800/r)*r,a=g.detail.dataChart.findIndex(function(e){return e.time==1e3*t});-1<a&&(0<e.amount?(g.detail.dataChart[a].in+=e.amount,g.detail.dataChart[a].in=parseFloat(g.detail.dataChart[a].in.toFixed(8)),g.detail.dataChart.totalIn+=e.amount):(g.detail.dataChart[a].out-=Math.abs(e.amount),g.detail.dataChart[a].out=parseFloat(g.detail.dataChart[a].out.toFixed(8)),g.detail.dataChart.totalOut+=e.amount))}),g.detail.dataChart.totalIn=parseFloat(g.detail.dataChart.totalIn.toFixed(8)),g.detail.dataChart.totalOut=parseFloat(g.detail.dataChart.totalOut.toFixed(8)),null==o&&(o=Morris.Line({element:"chartLines",data:[],xkey:"time",ykeys:["in","out"],labels:["vIn","vOut"],resize:!0,pointSize:3,smooth:!1,gridTextColor:"#474e54",gridLineColor:"#eef0f2",goalLineColors:"#e3e6ea",gridTextWeight:"300",numLines:9,gridtextSize:14,lineWidth:1,lineColors:["#00b300","#ff3333"]})),o.setData(g.detail.dataChart)}},0)}),electron.ipcRenderer.on("child-update-chart",function(e,t){f(function(){null!=o&&o.setData(g.detail.dataChart)},0)}),electron.ipcRenderer.on("child-get-data-zcash",function(e,t){f(function(){var e=t.msg;console.log(e),"getinfo"==e.key?lastBlock!=e.value.result.blocks?(lastBlock=e.value.result.blocks,g.rawData.connectionCount=e.value.result.connections,g.dataChange.getinfo=!0):g.dataChange.getinfo=!1:"getwalletinfo"==e.key?null==lastBalance||lastBalance.balance!=e.value.result.balance||lastBalance.unconfirmed_balance!=e.value.result.unconfirmed_balance||lastBalance.immature_balance!=e.value.result.immature_balance?(lastBalance=e.value.result,g.rawData.unconfirmedbalance=e.value.result.unconfirmed_balance,g.rawData.immaturebalance=e.value.result.immature_balance,g.dataChange.getwalletinfo=!0):g.dataChange.getwalletinfo=!1:"z_gettotalbalance"==e.key&&(null==lastTotalBalance||lastTotalBalance.transparent!=e.value.result.transparent||lastTotalBalance.private!=e.value.result.private?(lastTotalBalance=e.value.result,g.rawData.totalbalance=e.value.result.total,g.rawData.privatebalance=e.value.result.private,g.rawData.transparentbalance=e.value.result.transparent,g.dataChange.z_gettotalbalance=!0):g.dataChange.z_gettotalbalance=!1),null!=g.dataChange.z_gettotalbalance&&null!=g.dataChange.getwalletinfo&&null!=g.dataChange.getinfo&&(g.dataChange.z_gettotalbalance||g.dataChange.getwalletinfo||g.dataChange.getinfo)||shouldGetAll?(g.dataChange.getinfo=void 0,g.dataChange.getwalletinfo=void 0,g.dataChange.z_gettotalbalance=void 0,null!=apiStatus.getwalletdata&&0!=apiStatus.getwalletdata||(apiStatus.getwalletdata=!0,getBestBlockhash(serverData.cointype))):0==g.dataChange.z_gettotalbalance&&0==g.dataChange.getwalletinfo&&0==g.dataChange.getinfo&&(writeLog("set time out 2"),setTimeout(l,1e4))},0)}),electron.ipcRenderer.on("child-get-blockchain-info-zcash",function(e,t){writeLog("child-get-blockchain-info-zcash"),f(function(){g.rawData.bestblockhash=t.msg.value.result.bestblockhash,getBestTime(g.rawData.bestblockhash,serverData.cointype)},0)}),electron.ipcRenderer.on("child-get-block-header-zcash",function(e,t){writeLog("child-get-block-header-zcash"),f(function(){g.rawData.besttime=t.msg.value.result.time,listTransactions(200,serverData.cointype)},0)}),electron.ipcRenderer.on("child-list-transactions-zcash",function(e,t){writeLog("child-list-transactions-zcash"),f(function(){g.rawData.listtransactions=t.msg.value.result,listReceivedByAddress(serverData.cointype)},0)}),electron.ipcRenderer.on("child-list-received-by-address-zcash",function(e,t){writeLog("child-list-received-by-address-zcash"),f(function(){null!=t.msg.value.result?(t.msg.value.result.forEach(function(e){g.walletData[e.address]={amount:0,ismine:!1}}),listAddressGroupings(serverData.cointype)):(apiStatus.getwalletdata=!1,shouldGetAll=!1,setTimeout(l,1e4))},0)}),electron.ipcRenderer.on("child-list-address-groupings-zcash",function(e,t){f(function(){var a=Object.keys(g.walletData);null!=t.msg.value.result?(t.msg.value.result.forEach(function(e){e.forEach(function(t){if(-1==a.findIndex(function(e){return e==t[0]})){g.walletData[t[0]]={amount:0,ismine:!1}}})}),zListAddress(serverData.cointype)):(apiStatus.getwalletdata=!1,shouldGetAll=!1,setTimeout(l,1e4))},0)}),electron.ipcRenderer.on("child-z-list-address-zcash",function(e,t){writeLog("child-z-list-address-zcash"),f(function(){var e;null!=t.msg.value.result?(t.msg.value.result.forEach(function(e){g.walletData[e]={amount:0,ismine:!1}}),writeLog(e=g.walletData),a=Object.keys(e),g.rawData.addressbalance=e,s()):(apiStatus.getwalletdata=!1,shouldGetAll=!1,setTimeout(l,1e4))},0)}),electron.ipcRenderer.on("child-validate-address-zcash",function(e,t){f(function(){0==t.msg.value.result.isvalid?verifyZAddress(t.msg.arg[1],void 0,serverData.cointype):(g.rawData.addressbalance[t.msg.arg[1]].ismine=t.msg.value.result.ismine,s())},0)}),electron.ipcRenderer.on("child-z-validate-address-zcash",function(e,t){f(function(){g.rawData.addressbalance[t.msg.arg[1]].ismine=t.msg.value.result.ismine,s()},0)}),electron.ipcRenderer.on("child-z-get-balance-zcash",function(e,t){f(function(){g.rawData.addressbalance[t.msg.arg[1]].amount=t.msg.value.result,r()},0)}),electron.ipcRenderer.on("child-notification-data",function(e,t){var a=t.msg.banner;f(function(){if(null!=a&&0<a.length){var e=Math.floor(Math.random()*a.length);checkNoticeDisplay(serverData,a[e].type)?(g.detail.banner=a[e],g.detail.showBanner=!0,saveNoticeDisplay(a[e].type,a[e].name)):g.detail.showBanner=!1}},0)})}]),app.controller("SendCtrl",["$scope","$http","$timeout",function(r,e,o){function s(e,t,a){var n=[ScreenType.SEND,!0];electron.ipcRenderer.send("main-show-screen",n),o(function(){r.detail.title=null==a?"Alert!!!":a,r.detail.text=t,e==MsgType.ALERT?$("#modalSendAlert").modal():e==MsgType.CONFIRMATION&&$("#modalSendConfirmation").modal()},0)}r.publicAddresses=[],r.privateAddresses=[],r.books=[],r.detail={},r.detail.selected=void 0,r.detail.recipientAddress=void 0,r.detail.message=void 0,r.detail.amount=void 0,r.detail.value="1",r.detail.fee=1e-4,r.detail.btnDisable=!1,r.visible=!1,r.sendClick=function(){if(null==r.detail.selected||""==r.detail.selected)return writeLog("send address = null"),void s(MsgType.ALERT,"Please select send address");if(null==r.detail.recipientAddress||""==r.detail.recipientAddress)return writeLog("recipient address = null"),void s(MsgType.ALERT,"Please put receiver address");if(null==r.detail.amount||""==r.detail.amount)return writeLog("amount = null"),void s(MsgType.ALERT,"Please put amount to send");if(writeLog(r.detail.fee),null==r.detail.fee||""===r.detail.fee)return writeLog("fee = null"),void s(MsgType.ALERT,"Please put transaction fee");writeLog("verifyAddress"),r.detail.btnDisable=!0;var e={};e.from=r.detail.selected,e.to=r.detail.recipientAddress;var t=parseFloat(r.detail.amount)*parseFloat(r.detail.value);e.amount=t,e.fee=r.detail.fee,verifyAddress(r.detail.recipientAddress,e)},r.selectAddress=function(e){r.detail.selected=e},r.detail.recipientAddressChange=function(e){r.detail.recipientAddress=e},r.amountChange=function(e){r.detail.amount=e},r.valueChange=function(e){r.detail.value=e},r.feeChange=function(e){r.detail.fee=e},r.messageChange=function(e){r.detail.message=e},r.faq=function(){shell.openExternal("https://snowgem.org/faq")},r.maxCoinClick=function(){var e=r.publicAddresses.concat(r.privateAddresses),t=0;e.forEach(function(e){e.value==r.detail.selected&&(t=e.amount)}),r.detail.amount=parseFloat((parseFloat(t)-parseFloat(r.detail.fee)).toFixed(8))},electron.ipcRenderer.on("child-update-send",function(e,t){var n,i,s,a=t.msg;i=(n=a).from,s=Object.keys(i),writeLog("JSON.stringify(walletDic)"),o(function(){r.publicAddresses=[],r.privateAddresses=[],s.forEach(function(e){var t,a={};a.text=e+" - "+i[e].amount,a.value=e.split(" (")[0],a.amount=i[e].amount,e.startsWith("z")?-1==(t=r.privateAddresses.findIndex(function(e){return e.text.split(" - ")[0]===a.text.split(" - ")[0]}))?0<i[e].amount&&r.privateAddresses.push(a):r.privateAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0<parseFloat(a.text.split(" - ")[1])?r.privateAddresses[t].text=a.text:r.privateAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0==parseFloat(a.text.split(" - ")[1])&&r.privateAddresses.splice(t,1):-1==(t=r.publicAddresses.findIndex(function(e){return e.text.split(" - ")[0]===a.text.split(" - ")[0]}))?0<i[e].amount&&i[e].ismine&&r.publicAddresses.push(a):r.publicAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0<parseFloat(a.text.split(" - ")[1])?r.publicAddresses[t].text=a.text:r.publicAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0==parseFloat(a.text.split(" - ")[1])&&r.publicAddresses.splice(t,1)});var a=n.book;null!=a&&(r.books=[],(s=Object.keys(a)).forEach(function(e){var t={};t.text=a[e],t.value=e,0<!r.books.filter(function(e){return e.text===t.text}).length&&r.books.push(t)}),addrBook=JSON.parse(angular.toJson(r.books))),null==r.detail.selected&&0<r.publicAddresses.length&&(r.detail.selected=r.publicAddresses[0].value)},0)}),electron.ipcRenderer.on("child-verify-address",function(e,t){var a=t.msg,n=a[0].result,i=a[1];null!=n&&1==n.isvalid?o(function(){exec_sendCoin(i[2].from,i[2].to,String(i[2].amount).replace(",","."),String(i[2].fee).replace(",","."),SendType.NORMAL)},0):null!=n&&0==n.isvalid&&o(function(){writeLog(i[2]),verifyZAddress(i[2].to,i[2])},0)}),electron.ipcRenderer.on("child-verify-zaddress",function(e,t){var a=t.msg,n=a[0].result,i=a[1];null!=n&&1==n.isvalid?o(function(){exec_sendCoin(i[2].from,i[2].to,String(i[2].amount).replace(",","."),String(i[2].fee).replace(",","."),SendType.NORMAL)},0):null!=n&&0==n.isvalid&&o(function(){r.detail.btnDisable=!1,s(MsgType.ALERT,"Invalid address "+r.detail.recipientAddress)},0)}),electron.ipcRenderer.on("child-send-coin",function(e,t){var a=t.msg;null!=a.result?checkTransaction(a.result,SendType.NORMAL):o(function(){r.detail.btnDisable=!1,s(MsgType.ALERT,a.error.message)},0)}),electron.ipcRenderer.on("child-check-transaction",function(e,t){var a=t.msg;if(null==a.result)o(function(){r.detail.btnDisable=!1,s(MsgType.ALERT,"Check transaction error")},0);else{var n=a.result[0],i=n.status;"executing"==i?setTimeout(function(){checkTransaction(n.id,SendType.NORMAL)},2e3):"success"==i?o(function(){r.detail.btnDisable=!1,s(MsgType.ALERT,"Success",""),shouldGetAll=!0},0):(r.detail.btnDisable=!1,s(MsgType.ALERT,n.error.message))}}),electron.ipcRenderer.on("child-update-settings",function(e,t){o(function(){null!=t.msg[2]&&null!=t.msg[2]&&(r.detail.sticker=t.msg[2].sticker,r.detail.stickerSmall="m"+t.msg[2].sticker)},0)})}]),app.controller("ShieldCtrl",["$scope","$http","$timeout",function(s,e,r){s.publicAddresses=[],s.privateAddresses=[],s.shieldAddresses=[],s.detail={},s.detail.shieldAddress=void 0,s.detail.publicAddr=void 0,s.detail.privateAddr=void 0,s.detail.fee=1e-4,s.detail.remainingvalue=0;var i=!1,o=!1,l=!1,n=void 0;function d(e,t,a){var n=[ScreenType.SHIELD,!0];electron.ipcRenderer.send("main-show-screen",n),r(function(){s.detail.title=null==a?"Alert!!!":a,s.detail.text=t,e==MsgType.ALERT?$("#modalShieldAlert").modal():e==MsgType.CONFIRMATION&&$("#shieldAllConfirmation").modal()},0)}function c(e,t,a){s.detail.lastBestTime!=s.detail.bestTime?(clearInterval(n),n=void 0,exec_sendCoin(e,t,0,a,SendType.SHIELD)):null==n&&(n=setInterval(function(){c(e,t,a)},2e3))}s.detail.btnEnabled=!0,s.detail.bestTime=-1,s.detail.lastBestTime=-1,s.selectPubAddress=function(e){s.detail.publicAddr=e},s.selectPrivAddress=function(e){s.detail.privateAddr=e},s.shieldClick=function(){return o=!1,null==s.detail.publicAddr?(writeLog("send address = null"),void d(MsgType.ALERT,"Please select send address")):null==s.detail.privateAddr||""==s.detail.privateAddr?(writeLog("recipient address = null"),void d(MsgType.ALERT,"Please put receiver address")):null==s.detail.fee||""==s.detail.fee?(writeLog("fee = null"),void d(MsgType.ALERT,"Please put transaction fee")):(s.detail.btnEnabled=!1,i=!1,void exec_sendCoin(s.detail.publicAddr,s.detail.privateAddr,0,String(s.detail.fee).replace(",","."),SendType.SHIELD))},s.shieldAllClick=function(){return o=!1,null==s.detail.privateAddr||""==s.detail.privateAddr?(writeLog("recipient address = null"),void d(MsgType.ALERT,"Please put receiver address")):null==s.detail.fee||""==s.detail.fee?(writeLog("fee = null"),void d(MsgType.ALERT,"Please put transaction fee")):void d(MsgType.CONFIRMATION,"Do you want to shield all generated coin to "+s.detail.privateAddr,"Are you sure?")},s.shieldAllAction=function(){0<s.publicAddresses.length?(s.detail.btnEnabled=!1,i=!0,exec_sendCoin("*",s.detail.privateAddr,0,String(s.detail.fee).replace(",","."),SendType.SHIELD)):d(MsgType.ALERT,"No coin to shield")},s.faq=function(){shell.openExternal("https://snowgem.org/faq")},electron.ipcRenderer.on("child-update-shield",function(e,t){var n,a,i=t.msg;n=i.from,a=Object.keys(n),r(function(){s.publicAddresses=[],s.privateAddresses=[],a.forEach(function(e){var t,a={};a.text=e+" - "+n[e].amount,a.value=e.split(" (")[0],e.startsWith("z")?-1==(t=s.privateAddresses.findIndex(function(e){return e.text.split(" - ")[0]===a.text.split(" - ")[0]}))?s.privateAddresses.push(a):s.privateAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&(s.privateAddresses[t].text=a.text):-1==(t=s.publicAddresses.findIndex(function(e){return e.text.split(" - ")[0]===a.text.split(" - ")[0]}))?0<n[e].amount&&n[e].ismine&&s.publicAddresses.push(a):s.publicAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0<parseFloat(a.text.split(" - ")[1])?s.publicAddresses[t].text=a.text:s.publicAddresses[t].text.split(" - ")[1]!=a.text.split(" - ")[1]&&0==parseFloat(a.text.split(" - ")[1])&&s.publicAddresses.splice(t,1)})},0)}),electron.ipcRenderer.on("child-shield-coin",function(e,t){var a=t.msg.value;r(function(){if(null==a.result)if(i)if(-6==a.error.code||s.detail.remainingvalue<8)if(s.detail.btnEnabled=!0,shouldGetAll=!0,o){sendBotReplyMsg(e="Shield all is done"),writeLog("Auto shield is done")}else{var e="Shield all is done";d(MsgType.ALERT,e,"")}else console.log(a);else if(l){if(-6==a.error.code&&0<s.shieldAddresses.length)if(s.shieldAddresses.splice(0,1),0==s.shieldAddresses.length){s.detail.btnEnabled=!0,shouldGetAll=!0;var e="Multiple shield is done";d(MsgType.ALERT,e,"")}else exec_sendCoin(s.shieldAddresses[0],s.detail.privateAddr,0,s.detail.fee,SendType.SHIELD)}else d(MsgType.ALERT,a.error.message),s.detail.btnEnabled=!0;else checkTransaction(a.result.opid,SendType.SHIELD)},0)}),electron.ipcRenderer.on("child-check-transaction-shield",function(e,t){writeLog(t.msg);var n=t.msg;r(function(){if(null==n.result){if(!i&&!l)if(s.detail.btnEnabled=!0,o)sendBotReplyMsg(a="Check transaction error"),writeLog(a);else d(MsgType.ALERT,"Check transaction error")}else{var e=n.result[0],t=e.status;if(writeLog(t),"executing"==t)setTimeout(function(){checkTransaction(e.id,SendType.SHIELD)},2e3);else if("success"==t){if(i)if(s.detail.remainingvalue<8)if(s.detail.btnEnabled=!0,shouldGetAll=!0,o){sendBotReplyMsg(a="Shield all is done"),writeLog("Auto shield is done")}else{var a="Shield all is done";d(MsgType.ALERT,a,"")}else s.detail.lastBestTime=s.detail.bestTime,c("*",s.detail.privateAddr,String(s.detail.fee).replace(",","."));else l?0<s.shieldAddresses.length&&(s.shieldAddresses.splice(0,1),0==s.shieldAddresses.length?(s.detail.btnEnabled=!0,shouldGetAll=!0,d(MsgType.ALERT,"Multiple shield is done","")):(s.detail.lastBestTime=s.detail.bestTime,c(s.shieldAddresses[0],s.detail.privateAddr,String(s.detail.fee).replace(",",".")))):(s.detail.btnEnabled=!0,shouldGetAll=!0,d(MsgType.ALERT,"Success",""));shouldGetAll=!0}else i?(s.detail.lastBestTime=s.detail.bestTime,c("*",s.detail.privateAddr,String(s.detail.fee).replace(",","."))):(s.detail.btnEnabled=!0,d(MsgType.ALERT,e))}},0)}),electron.ipcRenderer.on("child-execute-shield-all",function(e,a){writeLog(a.msg),setInterval(function(){var e,t;e=a.msg.shieldthreshold,t=a.msg.shieldaddress,writeLog("check auto shield, locked coin = "+s.detail.remainingvalue+", threshold = "+e),!i&&isSynced&&parseInt(s.detail.remainingvalue)>=e&&(s.detail.privateAddr=t,o=!0,s.detail.btnEnabled=!1,i=!0,exec_sendCoin("*",s.detail.privateAddr,0,s.detail.fee,SendType.SHIELD))},6e4)}),electron.ipcRenderer.on("child-execute-multiple-shield",function(e,t){var a;writeLog(t.msg),s.shieldAddresses=t.msg.shieldAddress,a=t.msg.privateAddr,!i&&isSynced?(s.detail.privateAddr=a,l=!0,s.detail.btnEnabled=!1,o=i=!1,exec_sendCoin(s.shieldAddresses[0],s.detail.privateAddr,0,s.detail.fee,SendType.SHIELD)):isSynced||d(MsgType.ALERT,"Your wallet is not synced")}),electron.ipcRenderer.on("child-update-locked-coin",function(e,t){r(function(){s.detail.remainingvalue=t.msg})}),electron.ipcRenderer.on("child-update-loading",function(e,t){var a=t.msg;r(function(){s.detail.bestTime=null==a.besttime?-1:a.besttime},0)})}]),app.controller("TransactionsCtrl",["$scope","$http","$timeout",function(s,e,r){s.transactions=[],s.detail={},s.visible=!1,s.transactionData,s.viewDetail=function(e){s.transactionData=JSON.stringify(e,null,2);var t=e.txid;s.detail.txurl=(serverData.explorer.endsWith("/")?serverData.explorer:serverData.explorer+"/")+t,$("#txModal").modal()},s.faq=function(){shell.openExternal("https://snowgem.org/faq")},electron.ipcRenderer.on("child-update-transactions",function(e,t){var a,n,i;a=t.msg,n=a.data,i=1,r(function(){0!=s.transactions.length&&s.transactions[0].key==n[0].txid&&s.transactions[0].confirmations==n[0].confirmations||(ipc.send("main-update-transactions-time",a),s.transactions=[],n.some(function(e){var t={};t.no=i,t.direction=s.directionClass=e.category,t.date=timeConverter(e.time),t.address=null!=e.address?e.address:"Private address",t.amount=Math.abs(e.amount),"generate"!=e.category?t.validated=5<=e.confirmations?"Yes":"No ("+e.confirmations+")":t.validated=100<=e.confirmations?"Yes":"Immature ("+e.confirmations+")",t.confirmations=e.confirmations,t.value=e,t.key=e.txid,s.transactions.push(t),i+=1})),transactions=s.transactions},0)})}]),app.controller("SettingsCtrl",["$scope","$http","$timeout",function(s,e,r){s.detail={},s.privateAddresses=[],s.privateAddressesTemp=[],s.detail.btnEnabled=!1;var t=[];function i(e,t,a,n){var i=[ScreenType.SETTINGS,!1];electron.ipcRenderer.send("main-show-screen",i),r(function(){s.detail.title=null==n?"Alert!!!":n,s.detail.text=t,s.detail.btn=a,e==MsgType.CONFIRMATION?$("#restartWallet").modal():e==MsgType.CONFIRMATION2?$("#restartWallet2").modal():e==MsgType.DEFAULT_SETTINGS?$("#defaultSettings").modal():e==MsgType.ALERT?$("#alertSettings").modal():e==MsgType.ADD_PEERS?$("#addPeersSettings").modal():e==MsgType.DEBUG?$("#debugSettings").modal():e==MsgType.GET_PEERS&&$("#getPeersSettings").modal()},0)}function a(t){r(function(){if((s.detail.daemon=t.daemon,s.detail.autoupdatedaemon=t.autoupdatedaemon,s.detail.dataLocation=t.datafolder,s.detail.backgroundLocation=t.background,s.detail.autostart=t.autostart,s.detail.enablelog=t.enablelog,s.detail.transactionschart=t.transactionschart,s.detail.closeminimize=t.closeminimize,null==t.currency?(s.detail.currency="USD",s.detail.symbol="$"):(s.detail.currency=t.currency,s.detail.symbol=t.symbol),s.detail.coins=coinList.coins,s.detail.autoshield=t.autoshield,null!=t.shieldaddress)&&-1==s.privateAddresses.findIndex(function(e){return e.text==t.shieldaddress})){var e={};e.text=t.shieldaddress,e.value=t.shieldaddress,s.privateAddresses.push(e)}s.detail.shieldaddress=t.shieldaddress,s.detail.shieldthreshold=t.shieldthreshold,s.detail.hidezeroaddress=t.hidezeroaddress,null!=t.datetime?s.detail.datetime=t.datetime:s.detail.datetime="1",null!=t.transactionstime?s.detail.transactionstime=t.transactionstime:s.detail.transactionstime="1",null!=t.bot&&(s.detail.bot=t.bot,s.detail.apikey=t.apikey,s.detail.botname=t.botname)},0)}function n(){if(stopWallet(),checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result&&null!=helpData.errno){electron.ipcRenderer.send("main-reload",[])}else setTimeout(n,500);else setTimeout(n,500)}function o(t){if(stopWallet(),checkWallet(),null!=helpData&&null!=helpData)if(null==helpData.result&&null!=helpData.errno){var a=getUserHome(serverData,settings);function n(e){fsextra.copySync(e,a+"/wallet.dat");electron.ipcRenderer.send("main-reload",[])}fs.existsSync(a+"/wallet.dat")?fsextra.move(a+"/wallet.dat",a+"/wallet.dat."+Math.round((new Date).getTime()/1e3),function(e){if(e)return console.error(e);n(t)}):n(t)}else setTimeout(o,500,t);else setTimeout(o,500,t)}s.detail.debugdata="",s.detail.datetime=0,s.detail.transactionstime=0,s.detail.showTransactionTime=!1,s.detail.datetimeType=[{key:"YYYY/MM/DD",value:1},{key:"DD/MM/YYYY",value:2}],s.detail.transactionsType=[{key:"Day",value:1},{key:"Week",value:2},{key:"Month",value:3},{key:"Quarter",value:4},{key:"Year",value:5}],s.detail.bottype=["Do not use","Discord"],s.openDaemon=function(){var e;"win32"==process.platform?e={filters:[{name:serverData.daemon,extensions:["exe"]}],properties:["openFile"]}:"linux"!=process.platform&&"darwin"!=process.platform||(e={filters:[{name:serverData.daemon}],properties:["openFile"]}),dialog.showOpenDialog(e,function(e){void 0===e?writeLog("No file selected"):r(function(){s.detail.daemon=e[0].replace(/\\/g,"/")},0)})},s.openCli=function(){var e;"win32"==process.platform?e={filters:[{name:serverData.cli,extensions:["exe"]}],properties:["openFile"]}:"linux"!=process.platform&&"darwin"!=process.platform||(e={filters:[{name:serverData.cli}],properties:["openFile"]}),dialog.showOpenDialog(e,function(e){void 0===e?writeLog("No file selected"):r(function(){s.detail.cli=e[0].replace(/\\/g,"/")},0)})},s.openDataLocation=function(){s.detail.disableSelectDirectory=!0;dialog.showOpenDialog({properties:["openDirectory"]},function(e){r(function(){s.detail.disableSelectDirectory=!1,void 0===e?writeLog("No folder selected"):document.getElementById("data-dir").value=s.detail.dataLocation=e[0]},0)})},s.openBackground=function(){dialog.showOpenDialog({filters:[{name:"Images",extensions:["jpg","png","gif"]}],properties:["openFile"]},function(e){void 0===e?writeLog("No file selected"):r(function(){s.detail.backgroundLocation=e[0].replace(/\\/g,"/")},0)})},s.faq=function(){shell.openExternal("https://snowgem.org/faq")},s.valueChange=function(t){s.detail.currency=t;var e=s.detail.price.findIndex(function(e){return e.code==t});-1<e?(s.detail.symbol=s.detail.price[e].symbol,writeLog(s.detail.symbol)):s.detail.symbol="*"},s.botTypeChange=function(){"Discord"!=s.detail.bot&&"Telegram"!=s.detail.bot||(s.detail.apiKey=null==settings[s.detail.bot]?"":settings[s.detail.bot])},s.botNamePress=function(e){32===e.keyCode&&(alert("No space for bot name"),e.preventDefault())},s.applyClick=function(){var e,t=((e={}).daemon=s.detail.daemon,e.autoupdatedaemon=s.detail.autoupdatedaemon,e.background=s.detail.backgroundLocation,e.autostart=s.detail.autostart,e.enablelog=s.detail.enablelog,e.currency=s.detail.currency,e.symbol=s.detail.symbol,e.transactionschart=s.detail.transactionschart,e.datafolder=s.detail.dataLocation,e.closeminimize=s.detail.closeminimize,e.autoshield=s.detail.autoshield,e.shieldthreshold=s.detail.shieldthreshold,e.shieldaddress=s.detail.shieldaddress,e.hidezeroaddress=s.detail.hidezeroaddress,e.datetime=s.detail.datetime,e.transactionstime=s.detail.transactionstime,"Discord"!=s.detail.bot&&"Telegram"!=s.detail.bot||(e.bot=s.detail.bot,e.apikey=s.detail.apikey,e.botname=s.detail.botname),e);if(null!=t.bot){if(null==t.botname||""==t.botname)return void i(MsgType.ALERT,"Bot name could not be empty","Failed!!!");if(null==t.apikey||""==t.apikey)return void i(MsgType.ALERT,"API key could not be empty","Failed!!!")}saveSettings(t,s.detail.currentCoin);var a={};writeLog(s.detail.currentCoin),a.coinname=s.detail.currentCoin,saveCurrentCoin(JSON.stringify(a)),currentCoin!=s.detail.currentCoin?i(MsgType.CONFIRMATION2,"You have to restart wallet to change coin. Please wait until wallet is reloaded","Restart",""):i(MsgType.CONFIRMATION,"Restart wallet to apply new changes","Restart","Do you want to restart wallet?")},s.cancelClick=function(){writeLog("populateSettings"),s.privateAddresses=s.privateAddressesTemp,scope.detail.currentCoin=currentCoin,a(settings)},s.defaultClick=function(){i(MsgType.DEFAULT_SETTINGS,"Revert to default settings?","OK","Are you sure?")},s.restartAction=function(){helpData=void 0,setTimeout(n,500)},s.defaultAction=function(){var e=getWalletHome(!1,currentCoin)+"/settings.json";writeLog("remove old settings "+e),fs.existsSync(e)&&(writeLog("remove old settings"),fs.unlinkSync(e)),i(MsgType.CONFIRMATION,"Restart wallet to apply new changes","Restart","Do you want to restart wallet?")},s.getPeers=function(){getPeerInfo()},s.addPeers=function(){i(MsgType.ADD_PEERS,"","","Add Peers")},s.backupClick=function(){var e;e={filters:[{name:"",extensions:["dat"]}],properties:["openFile"]},dialog.showSaveDialog(e,function(e){var t=getUserHome(serverData,settings);fs.existsSync(t+"/wallet.dat")?(fsextra.copySync(t+"/wallet.dat",e),i(MsgType.ALERT,"Wallet has been backed up to: "+e,"Success!!!")):i(MsgType.ALERT,"Cannot backup wallet","Failed!!!")})},s.restoreClick=function(){var e;e={filters:[{name:serverData.daemon,extensions:["dat"]}],properties:["openFile"]},dialog.showOpenDialog(e,function(e){void 0===e?writeLog("No file selected"):(i(MsgType.ALERT,"Backing up wallet, please wait until it's reloaded"),setTimeout(o,500,e[0].replace(/\\/g,"/")))})},s.rescanClick=function(){var e=getWalletHome(!0);fs.writeFileSync(e+"/commands.txt","-rescan"),i(MsgType.CONFIRMATION,"Restart wallet to rescan wallet","Restart","Do you want to restart wallet?")},s.reindexClick=function(){var e=getWalletHome(!0);fs.writeFileSync(e+"/commands.txt","-reindex"),i(MsgType.CONFIRMATION,"Restart wallet to rescan wallet","Restart","Do you want to restart wallet?")},s.addPeersAction=function(e){var t=getUserHome(serverData,settings)+"/"+serverData.conf_file;fs.appendFileSync(t,e),detail.peersList="",i(MsgType.CONFIRMATION,"Restart wallet to reindex wallet","Restart","Do you want to restart wallet?")},s.debug=function(){i(MsgType.DEBUG,"","","")},s.selectCoin=function(e){var t=readSettings(e);null==t.enablelog&&(t.enablelog=!0),null==t.showTransactionTime&&(t.showTransactionTime=!1),e!=currentCoin?(s.privateAddressesTemp=s.privateAddresses,s.privateAddresses=[]):s.privateAddresses=s.privateAddressesTemp,a(t),s.detail.currentCoin=e},s.startDebugging=function(e){e.preventDefault(),13===e.keyCode&&(s.detail.debugdata+=s.detail.debugcommand+"\n",getDebug(s.detail.debugcommand),t.push(s.detail.debugcommand),s.detail.debugcommand=void 0)},s.dateChange=function(e){console.log(e)},electron.ipcRenderer.on("child-get-peer-info",function(e,t){var a=t.msg.result,n="\n";a.forEach(function(e){n+="addnode="+e.addr+"\n"}),i(MsgType.GET_PEERS,n,"","Peers List")}),electron.ipcRenderer.on("child-update-settings",function(e,t){writeLog("populateSettings"),r(function(){null!=t.msg[2]&&null!=t.msg[2]&&(s.detail.currentCoin=currentCoin),null!=settings&&null!=settings&&a(settings)},0)}),electron.ipcRenderer.on("child-get-debug",function(e,t){r(function(){null!=t.msg.result?s.detail.debugdata+=("string"==typeof t.msg.result?t.msg.result:JSON.stringify(t.msg.result,null,2))+"\n\n":s.detail.debugdata+=t.msg.error.message+"\n\n"},0)}),electron.ipcRenderer.on("child-update-price",function(e,t){r(function(){s.detail.price=JSON.parse(t.msg)},0)}),electron.ipcRenderer.on("child-update-shield",function(e,t){var n,a,i=t.msg;s.detail.currentCoin==currentCoin&&(n=i.from,a=Object.keys(n),r(function(){s.privateAddresses=[],a.forEach(function(e){var t={};if(t.text=e+" - "+n[e].amount,t.value=e.split(" (")[0],e.startsWith("z")){var a=s.privateAddresses.findIndex(function(e){return e.text.split(" - ")[0]===t.text.split(" - ")[0]});-1==a?s.privateAddresses.push(t):s.privateAddresses[a].text.split(" - ")[1]!=t.text.split(" - ")[1]&&(s.privateAddresses[a].text=t.text)}}),s.detail.btnEnabled=!0},0))});electron.ipcRenderer.on("child-update-settings",function(e,t){r(function(){null!=t.msg[2]&&null!=t.msg[2]&&(s.detail.showTransactionTime="snowgem"==t.msg[2].cointype)},0)})}]);
